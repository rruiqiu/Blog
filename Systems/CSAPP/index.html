
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../OSlab/">
      
      
        <link rel="next" href="../../Design%20Patterns/SOLID/">
      
      
      <link rel="icon" href="../../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>CSAPP - NoteBooks</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#csapp-computer-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NoteBooks" class="md-header__button md-logo" aria-label="NoteBooks" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NoteBooks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CSAPP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4m0-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Algorithms/Templates/" class="md-tabs__link">
          
  
  
  Algorithms

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Full%20Stack/Software%20Engineering/" class="md-tabs__link">
          
  
  
  Full Stack

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../OS/" class="md-tabs__link">
          
  
  
  Systems

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Design%20Patterns/SOLID/" class="md-tabs__link">
          
  
  
  Design Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Others/Celpip/" class="md-tabs__link">
          
  
  
  Others

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NoteBooks" class="md-nav__button md-logo" aria-label="NoteBooks" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    NoteBooks
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Arrays%20%26%20Hashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arrays & Hashing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Two%20Pointers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Two Pointers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Sliding%20Window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sliding Window
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Stack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Binary%20Search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Binary Search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Linked%20List/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linked List
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Trees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trees
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Priority%20Queue%28Heap%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Heap / Priority Queue
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Backtracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backtracking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Tries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graphs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Advanced%20Graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Graphs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/1-D%20Dynamic%20Programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1-D Dynamic Programming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/2-D%20Dynamic%20Programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2-D Dynamic Programming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Greedy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Greedy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Intervals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intervals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math%20%26%20Geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Math & Geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Bit%20Manipulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bit Manipulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Full Stack
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Full Stack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/Software%20Engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/DevOps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/React/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/Web%20Notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Notes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nginx
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSlab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CSAPP
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CSAPP
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab1-data-lab-c-bitwise-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Lab1 - Data Lab (C bitwise operations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-lab1-data-lab1" class="md-nav__link">
    <span class="md-ellipsis">
      For lab1. Data lab1.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For lab1. Data lab1.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point" class="md-nav__link">
    <span class="md-ellipsis">
      Floating point:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Floating point:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floatfloat2intf" class="md-nav__link">
    <span class="md-ellipsis">
      floatFloat2Int(f)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      Takeaway:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdb-debug-tool" class="md-nav__link">
    <span class="md-ellipsis">
      GDB Debug tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jump Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ans_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_6
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab3-attack-labcode-injection-and-rop-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Lab3 - Attack lab(Code Injection and ROP attack)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab3 - Attack lab(Code Injection and ROP attack)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-rdi-register-and-parameter-passing" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the rdi Register and Parameter Passing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab4" class="md-nav__link">
    <span class="md-ellipsis">
      Lab4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part1" class="md-nav__link">
    <span class="md-ellipsis">
      Part1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-and-typedef-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      struct and typedef in c
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lru-counter-logic" class="md-nav__link">
    <span class="md-ellipsis">
      LRU counter logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-b" class="md-nav__link">
    <span class="md-ellipsis">
      Part B:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part B:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32-x-32" class="md-nav__link">
    <span class="md-ellipsis">
      32 x 32
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-address-to-cache-index-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Address to Cache Index Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-akk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for A[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-bkk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for B[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplifying-the-index-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Simplifying the Index Calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-conflict-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Conflict Explanation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache Conflict Explanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#64-x-64" class="md-nav__link">
    <span class="md-ellipsis">
      64 x 64
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Design Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Design Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Design%20Patterns/SOLID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Principles (SOLID)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Structual Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Structual Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Design%20Patterns/Structual%20Patterns/Proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proxy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Design%20Patterns/Structual%20Patterns/Chain%20of%20Responsibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chain of Responsibility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Others/Celpip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Celpip
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab1-data-lab-c-bitwise-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Lab1 - Data Lab (C bitwise operations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-lab1-data-lab1" class="md-nav__link">
    <span class="md-ellipsis">
      For lab1. Data lab1.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For lab1. Data lab1.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point" class="md-nav__link">
    <span class="md-ellipsis">
      Floating point:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Floating point:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floatfloat2intf" class="md-nav__link">
    <span class="md-ellipsis">
      floatFloat2Int(f)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      Takeaway:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdb-debug-tool" class="md-nav__link">
    <span class="md-ellipsis">
      GDB Debug tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jump Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ans_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_6
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab3-attack-labcode-injection-and-rop-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Lab3 - Attack lab(Code Injection and ROP attack)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab3 - Attack lab(Code Injection and ROP attack)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-rdi-register-and-parameter-passing" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the rdi Register and Parameter Passing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab4" class="md-nav__link">
    <span class="md-ellipsis">
      Lab4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part1" class="md-nav__link">
    <span class="md-ellipsis">
      Part1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-and-typedef-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      struct and typedef in c
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lru-counter-logic" class="md-nav__link">
    <span class="md-ellipsis">
      LRU counter logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-b" class="md-nav__link">
    <span class="md-ellipsis">
      Part B:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part B:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32-x-32" class="md-nav__link">
    <span class="md-ellipsis">
      32 x 32
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-address-to-cache-index-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Address to Cache Index Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-akk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for A[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-bkk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for B[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplifying-the-index-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Simplifying the Index Calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-conflict-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Conflict Explanation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache Conflict Explanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#64-x-64" class="md-nav__link">
    <span class="md-ellipsis">
      64 x 64
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="csapp-computer-system">CSAPP - Computer System</h1>
<h2 id="lab1-data-lab-c-bitwise-operations">Lab1 - Data Lab (C bitwise operations)</h2>
<p>How to setup the test environment.</p>
<p>How to open VS code on WSL2. -&gt; Open Docker Desktop. On Vs code, type remote container</p>
<h2 id="for-lab1-data-lab1">For lab1. Data lab1.</h2>
<p>cd ~</p>
<p>ls</p>
<p>cd csapplab</p>
<p>cd datalab/datalab-handout</p>
<p>make clean <strong>&amp;&amp;</strong> make <strong>&amp;&amp;</strong> ./btest</p>
<p>Notes:</p>
<p>Q1. BitXor;</p>
<p><img alt="XOR Gate Truth Table, Symbol, Diagram, Application, Properties" src="../CSAPP.assets/clip_image002.png" /></p>
<p>Ideas: First find the OR gate of two inputs, flip them use not then and them. And the initial two inputs and not the output then finally and the two values. </p>
<h3 id="floating-point">Floating point:</h3>
<p><img alt="image-20240429002223878" src="../CSAPP.assets/image-20240429002223878.png" /></p>
<p><img alt="image-20240429002233108" src="../CSAPP.assets/image-20240429002233108.png" /></p>
<p>Will always convert to the form of M = 1.xxx, and M x 2^pow</p>
<h4 id="floatfloat2intf">floatFloat2Int(f)</h4>
<blockquote>
<p>将浮点数转换为整数</p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cm">/* </span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="cm"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cm"> *   for floating point argument f.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cm"> *   Argument is passed as unsigned int, but</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="cm"> *   it is to be interpreted as the bit-level representation of a</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="cm"> *   single-precision floating point value.</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="cm"> *   Anything out of range (including NaN and infinity) should return</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="cm"> *   0x80000000u.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="cm"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="cm"> *   Max ops: 30</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="cm"> *   Rating: 4</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="cm"> */</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">floatFloat2Int</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">uf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">s_</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">uf</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">exp_</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7f800000</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">)</span><span class="mi">-127</span><span class="p">;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">frac_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x007fffff</span><span class="p">)</span><span class="o">|</span><span class="mh">0x00800000</span><span class="p">;</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7fffffff</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">exp_</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mh">0x80000000</span><span class="p">;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">exp_</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">exp_</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">23</span><span class="p">)</span><span class="w"> </span><span class="n">frac_</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">exp_</span><span class="mi">-23</span><span class="p">);</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="n">frac_</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="p">(</span><span class="mi">23</span><span class="o">-</span><span class="n">exp_</span><span class="p">);</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">frac_</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">^</span><span class="n">s_</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">frac_</span><span class="p">;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">frac_</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mh">0x80000000</span><span class="p">;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">~</span><span class="n">frac_</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>思路</li>
</ul>
<p>首先考虑特殊情况：如果原浮点值为0则返回0；如果真实指数大于31（frac部分是大于等于1的，1&lt;&lt;31位会覆盖符号位），返回规定的溢出值<strong>0x80000000u</strong>；如果 𝑒𝑥𝑝&lt;0 （1右移x位,x&gt;0，结果为0）则返回0。剩下的情况：首先把小数部分（23位）转化为整数（和23比较），然后判断是否溢出：如果和原符号相同则直接返回，否则如果结果为负（原来为正）则溢出返回越界指定值<strong>0x80000000u</strong>，否则原来为负，结果为正，则需要返回其补码（相反数）。</p>
<p>The idea is to apply the concept that when converting from the binary int to the float format, need to use the normalized encoding idea.</p>
<h3 id="takeaway">Takeaway:</h3>
<p><img alt="image-20240429010601121" src="../CSAPP.assets/image-20240429010601121.png" /></p>
<p><img alt="image-20240429010732263" src="../CSAPP.assets/image-20240429010732263.png" /></p>
<p><img alt="image-20240429010854316" src="../CSAPP.assets/image-20240429010854316.png" /></p>
<ul>
<li>
<p>Any arithmetic operations with unsigned values will cast the result to be unsigned.</p>
</li>
<li>
<p>The size_t defined as unsinged value with length = word size, In C++, <code>size_t</code> is a data type used to represent the size of objects. It's an unsigned integer type that's capable of storing the size in bytes of any object. Its actual size can vary depending on the platform and compiler, but it's typically chosen to <strong>be large enough</strong> to represent the maximum possible size of a theoretically possible object on the given platform. size_t is better than used unsigned_int .</p>
</li>
<li>Reference https://pvs-studio.com/en/blog/terms/0044/#:~:text=The%20size_t%20is%20chosen%20so,64%2Dbit%20one%2064%20bits.</li>
<li>The <strong>2's complement</strong> of a value is <strong>~x + 1;</strong></li>
</ul>
<h2 id="lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program">Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)</h2>
<p><img alt="image-20240523224807402" src="../CSAPP.assets/image-20240523224807402.png" /></p>
<p><img alt="image-20240523224819581" src="../CSAPP.assets/image-20240523224819581.png" /></p>
<p><img alt="image-20240523225033369" src="../CSAPP.assets/image-20240523225033369.png" /></p>
<h3 id="gdb-debug-tool">GDB Debug tool</h3>
<p>To debug, use dgb debugged, the pdf can be found at this link</p>
<p>https://csapp.cs.cmu.edu/2e/docs/gdbnotes-x86-64.pdf</p>
<p>gdb object code or compiled code <code>gdb bomb</code></p>
<p>Inside, running disassmble function <code>disas &lt;function name&gt;</code></p>
<p><code>x/s 0x402400</code> x/s will be used to Examine a string stored at 0xbffff890.</p>
<p>Write a function in x64</p>
<p><img alt="image-20240524232341653" src="../CSAPP.assets/image-20240524232341653.png" /></p>
<h3 id="phase_1">Phase_1</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Dump of assembler code for function phase_1:
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>   0x0000000000400ee0 &lt;+0&gt;:     sub    $0x8,%rsp
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>   0x0000000000400ee4 &lt;+4&gt;:     mov    $0x402400,%esi
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>   0x0000000000400ee9 &lt;+9&gt;:     callq  0x401338 &lt;strings_not_equal&gt;
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>   0x0000000000400eee &lt;+14&gt;:    test   %eax,%eax
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>//Expected return eax to be zero to diffuse the bomb
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>   0x0000000000400ef0 &lt;+16&gt;:    je     0x400ef7 &lt;phase_1+23&gt;
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>   0x0000000000400ef2 &lt;+18&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>   0x0000000000400ef7 &lt;+23&gt;:    add    $0x8,%rsp
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>   0x0000000000400efb &lt;+27&gt;:    retq   
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>End of assembler dump.
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>Dump of assembler code for function strings_not_equal:
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>   0x0000000000401338 &lt;+0&gt;:     push   %r12
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>   0x000000000040133a &lt;+2&gt;:     push   %rbp
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>   0x000000000040133b &lt;+3&gt;:     push   %rbx
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>   0x000000000040133c &lt;+4&gt;:     mov    %rdi,%rbx
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>   0x000000000040133f &lt;+7&gt;:     mov    %rsi,%rbp
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>   0x0000000000401342 &lt;+10&gt;:    callq  0x40131b &lt;string_length&gt;
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>Dump of assembler code for function string_length:
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>   0x000000000040131b &lt;+0&gt;:     cmpb   $0x0,(%rdi)
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>   0x000000000040131e &lt;+3&gt;:     je     0x401332 &lt;string_length+23&gt;
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>   0x0000000000401320 &lt;+5&gt;:     mov    %rdi,%rdx
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>   0x0000000000401323 &lt;+8&gt;:     add    $0x1,%rdx
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>Address     Value
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>0x1000      &#39;h&#39;
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>0x1001      &#39;e&#39;
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>0x1002      &#39;l&#39;
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>0x1003      &#39;l&#39;
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>0x1004      &#39;o&#39;
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>0x1005      &#39;\0&#39; (null terminator)   
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>   0x0000000000401327 &lt;+12&gt;:    mov    %edx,%eax
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>   0x0000000000401329 &lt;+14&gt;:    sub    %edi,%eax
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>   0x000000000040132b &lt;+16&gt;:    cmpb   $0x0,(%rdx)
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>   0x000000000040132e &lt;+19&gt;:    jne    0x401323 &lt;string_length+8&gt;
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>   0x0000000000401330 &lt;+21&gt;:    repz retq 
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>   0x0000000000401332 &lt;+23&gt;:    mov    $0x0,%eax
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>   0x0000000000401337 &lt;+28&gt;:    retq   
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>End of assembler dump.
</span></code></pre></div>
<p>Explain of String_lengh:</p>
<p><code>Dump of assembler code for function string_length:
   0x000000000040131b &lt;+0&gt;:     cmpb   $0x0,(%rdi)
   0x000000000040131e &lt;+3&gt;:     je     0x401332 &lt;string_length+23&gt;
   0x0000000000401320 &lt;+5&gt;:     mov    %rdi,%rdx
   0x0000000000401323 &lt;+8&gt;:     add    $0x1,%rdx
   0x0000000000401327 &lt;+12&gt;:    mov    %edx,%eax
   0x0000000000401329 &lt;+14&gt;:    sub    %edi,%eax
   0x000000000040132b &lt;+16&gt;:    cmpb   $0x0,(%rdx)
   0x000000000040132e &lt;+19&gt;:    jne    0x401323 &lt;string_length+8&gt;
   0x0000000000401330 &lt;+21&gt;:    repz retq 
   0x0000000000401332 &lt;+23&gt;:    mov    $0x0,%eax
   0x0000000000401337 &lt;+28&gt;:    retq   
End of assembler dump.</code></p>
<p>First, compare the first dereference value at rdi, if not zero, go to the next statement, if zero. return 0.</p>
<p>Copy the input string rdi to the rdx,</p>
<p>Move the pointer one step at rdx,</p>
<p>Copy the edx to eax</p>
<p>Subtract eax from the original edi, it will perform the address subtracting. First loop should return 1 step,</p>
<p>Compare the next pointer address value if it is null with zero. If not, go back to the +8, if yes, it will return the eax reg.</p>
<p>This function is used to calcualte the string length.</p>
<p><img alt="image-20240525021728086" src="../CSAPP.assets/image-20240525021728086.png" /></p>
<p>In the main code section, the rdi is a  user input,</p>
<p>rsi is the direct access of the memory address at 0x402400.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Dump of assembler code for function strings_not_equal:
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>////what does it do, just compare tow input string, rdi and rsi, return the eax to zero if they are equal else return eax to 1
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>   0x0000000000401338 &lt;+0&gt;:     push   %r12
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>   0x000000000040133a &lt;+2&gt;:     push   %rbp
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>   0x000000000040133b &lt;+3&gt;:     push   %rbx
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>   0x000000000040133c &lt;+4&gt;:     mov    %rdi,%rbx
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>   0x000000000040133f &lt;+7&gt;:     mov    %rsi,%rbp
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>   0x0000000000401342 &lt;+10&gt;:    callq  0x40131b &lt;string_length&gt;
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>   0x0000000000401347 &lt;+15&gt;:    mov    %eax,%r12d
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>   0x000000000040134a &lt;+18&gt;:    mov    %rbp,%rdi
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>   0x000000000040134d &lt;+21&gt;:    callq  0x40131b &lt;string_length&gt;
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>   0x0000000000401352 &lt;+26&gt;:    mov    $0x1,%edx    
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>   0x0000000000401357 &lt;+31&gt;:    cmp    %eax,%r12d   //compare the length of two inputs
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>   0x000000000040135a &lt;+34&gt;:    jne    0x40139b &lt;strings_not_equal+99&gt;  //if not same, end, set eax = edx = 0x1
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>   0x000000000040135c &lt;+36&gt;:    movzbl (%rbx),%eax
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>   //what is movzbl, movz, convert the single byte into 4bytes, 8bit -32bit. and zero extend the eax register
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>Zero-Extension
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>Zero-Extend: This means that the rest of the EAX register (the upper 24 bits) will be set to zero after the byte is moved.
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>Example: If the byte at (%rbx) is 0x41 (which is the ASCII code for &#39;A&#39;):
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>After execution, EAX will be 0x00000041.
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>   0x000000000040135f &lt;+39&gt;:    test   %al,%al
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>   //zf set wen a&amp;b == 0, test the rax if the start is null, check the char if it is null, if null then both empty, still same return eax =0
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>   0x0000000000401361 &lt;+41&gt;:    je     0x401388 &lt;strings_not_equal+80&gt;
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>   0x0000000000401363 &lt;+43&gt;:    cmp    0x0(%rbp),%al
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>   0x0000000000401366 &lt;+46&gt;:    je     0x401372 &lt;strings_not_equal+58&gt;
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>   0x0000000000401368 &lt;+48&gt;:    jmp    0x40138f &lt;strings_not_equal+87&gt;
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>   0x000000000040136a &lt;+50&gt;:    cmp    0x0(%rbp),%al
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>   0x000000000040136d &lt;+53&gt;:    nopl   (%rax)
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>   0x0000000000401370 &lt;+56&gt;:    jne    0x401396 &lt;strings_not_equal+94&gt;
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>   0x0000000000401372 &lt;+58&gt;:    add    $0x1,%rbx
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>   0x0000000000401376 &lt;+62&gt;:    add    $0x1,%rbp
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>   0x000000000040137a &lt;+66&gt;:    movzbl (%rbx),%eax
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>   0x000000000040137d &lt;+69&gt;:    test   %al,%al
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>   0x000000000040137f &lt;+71&gt;:    jne    0x40136a &lt;strings_not_equal+50&gt;
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>   0x0000000000401381 &lt;+73&gt;:    mov    $0x0,%edx
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>   0x0000000000401386 &lt;+78&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>   0x0000000000401388 &lt;+80&gt;:    mov    $0x0,%edx
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>   0x000000000040138d &lt;+85&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>   0x000000000040138f &lt;+87&gt;:    mov    $0x1,%edx
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>   0x0000000000401394 &lt;+92&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>   0x0000000000401396 &lt;+94&gt;:    mov    $0x1,%edx
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>   0x000000000040139b &lt;+99&gt;:    mov    %edx,%eax
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>   0x000000000040139d &lt;+101&gt;:   pop    %rbx
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>   0x000000000040139e &lt;+102&gt;:   pop    %rbp
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>   0x000000000040139f &lt;+103&gt;:   pop    %r12
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>   0x00000000004013a1 &lt;+105&gt;:   retq   
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>End of assembler dump.
</span></code></pre></div>
<p><img alt="image-20240525141225889" src="../CSAPP.assets/image-20240525141225889.png" /></p>
<h4 id="ans">Ans:</h4>
<p>(gdb) x/s 0x402400</p>
<p>0x402400:       "Border relations with Canada have never been better."</p>
<p>Border relations with Canada have never been better.</p>
<h3 id="phase_2">Phase_2</h3>
<p>The <code>LEA</code> (Load Effective Address) instruction in x86-64 assembly language is used to perform address calculations and load the result into a register. Unlike other instructions that directly access memory, <code>LEA</code> simply computes an address and stores it in a register without accessing the memory at that address.</p>
<p>The purpose of <code>LEA</code> is to allow one to perform a non-trivial address calculation and store the result [for later usage]</p>
<p>Lea 用来计算地址，值不会进行传递</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>assembly
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Copy code
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>LEA destination, source
</span></code></pre></div>
<ul>
<li><strong>destination</strong>: A general-purpose register where the result of the address calculation will be stored.</li>
<li><strong>source</strong>: An effective address expression that typically involves base registers, index registers, scaling factors, and displacement values.</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Dump of assembler code for function phase_2:
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>   0x0000000000400efc &lt;+0&gt;:     push   %rbp
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>   0x0000000000400efd &lt;+1&gt;:     push   %rbx
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>   0x0000000000400efe &lt;+2&gt;:     sub    $0x28,%rsp
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>   //allocate 40bytes to store local variables on stack
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>   0x0000000000400f02 &lt;+6&gt;:     mov    %rsp,%rsi
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>   // rsi = rsp,
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>   0x0000000000400f05 &lt;+9&gt;:     callq  0x40145c &lt;read_six_numbers&gt;
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>   {
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>   rsi -&gt; rdx
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>   0x4 (rsi) -&gt; rcx
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>   6 overall registers and stack pointer as arguments to read and store the data in rsi = rsp(in phase_2),
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>   rsi -&gt; rdx first integer -&gt; rax
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>0x4(%rsp) =  0x4(%rsi) -&gt; rcx: Address for the second integer. -&gt; 0x4(rax)
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>0x14(%rsi) -&gt; rax: Address for the sixth integer. -&gt; + 4
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>0x10(%rsi) -&gt; rax: Address for the fifth integer. -&gt; +4
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>0xc(%rsi) -&gt; r9: Address for the fourth integer.    -&gt; +4
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>the scannf function will get the inputs from rdi, the format of rsi, and store the reading values at register rdx -&gt; stack, which is on rsp. and return rax, how many values read
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>   }
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>   0x0000000000400f0a &lt;+14&gt;:    cmpl   $0x1,(%rsp)
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>   // rsp 0x0 = 1
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>   0x0000000000400f10 &lt;+20&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>   0x0000000000400f15 &lt;+25&gt;:    jmp    0x400f30 &lt;phase_2+52&gt;
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>   0x0000000000400f17 &lt;+27&gt;:    mov    -0x4(%rbx),%eax
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>   0x0000000000400f1a &lt;+30&gt;:    add    %eax,%eax
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>   // adding the current one by itself -&gt; 1+1 = 2
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>   0x0000000000400f1c &lt;+32&gt;:    cmp    %eax,(%rbx)
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>   // the second int(0x4 rsp) = 2, do the same until it reaches 
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>   0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>   0x0000000000400f20 &lt;+36&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>   0x0000000000400f25 &lt;+41&gt;:    add    $0x4,%rbx
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>   //
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>   0x0000000000400f29 &lt;+45&gt;:    cmp    %rbp,%rbx
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>   // stop when the rbp is at 0x18 = 24bytes
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>   0x0000000000400f2c &lt;+48&gt;:    jne    0x400f17 &lt;phase_2+27&gt;
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>   0x0000000000400f2e &lt;+50&gt;:    jmp    0x400f3c &lt;phase_2+64&gt;
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>   0x0000000000400f30 &lt;+52&gt;:    lea    0x4(%rsp),%rbx
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>   0x0000000000400f35 &lt;+57&gt;:    lea    0x18(%rsp),%rbp
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>   //0x18 = 24, last digit in rbp
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>   0x0000000000400f3c &lt;+64&gt;:    add    $0x28,%rsp
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>   0x0000000000400f40 &lt;+68&gt;:    pop    %rbx
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>   0x0000000000400f41 &lt;+69&gt;:    pop    %rbp
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>   0x0000000000400f42 &lt;+70&gt;:    retq   
</span></code></pre></div>
<p><code>rdi is the input</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Dump of assembler code for function read_six_numbers:
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>   0x000000000040145c &lt;+0&gt;:     sub    $0x18,%rsp
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>   // assign 24 bytes to the rsp
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>   0x0000000000401460 &lt;+4&gt;:     mov    %rsi,%rdx
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>   0x0000000000401463 &lt;+7&gt;:     lea    0x4(%rsi),%rcx
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>   0x0000000000401467 &lt;+11&gt;:    lea    0x14(%rsi),%rax
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>   0x000000000040146b &lt;+15&gt;:    mov    %rax,0x8(%rsp)
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>   0x0000000000401470 &lt;+20&gt;:    lea    0x10(%rsi),%rax
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>   0x0000000000401474 &lt;+24&gt;:    mov    %rax,(%rsp)
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>   0x0000000000401478 &lt;+28&gt;:    lea    0xc(%rsi),%r9
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>   0x000000000040147c &lt;+32&gt;:    lea    0x8(%rsi),%r8
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>   0x0000000000401480 &lt;+36&gt;:    mov    $0x4025c3,%esi
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>   0x0000000000401485 &lt;+41&gt;:    mov    $0x0,%eax
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>   0x000000000040148a &lt;+46&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>   0x000000000040148f &lt;+51&gt;:    cmp    $0x5,%eax
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>   0x0000000000401492 &lt;+54&gt;:    jg     0x401499 &lt;read_six_numbers+61&gt;
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>   0x0000000000401494 &lt;+56&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>   0x0000000000401499 &lt;+61&gt;:    add    $0x18,%rsp
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>   0x000000000040149d &lt;+65&gt;:    retq   
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>End of assembler dump.
</span></code></pre></div>
<p>What this function does is to just read six numbers, and store them into each register </p>
<p><img alt="image-20240530002636750" src="../CSAPP.assets/image-20240530002636750.png" /></p>
<h4 id="ans_1">Ans:</h4>
<p>1 2 4 8 16 32</p>
<h3 id="phase_3">Phase_3</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Dump of assembler code for function phase_3:
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>   0x0000000000400f43 &lt;+0&gt;:     sub    $0x18,%rsp
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>   0x0000000000400f47 &lt;+4&gt;:     lea    0xc(%rsp),%rcx
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>   0x0000000000400f4c &lt;+9&gt;:     lea    0x8(%rsp),%rdx
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>   0x0000000000400f51 &lt;+14&gt;:    mov    $0x4025cf,%esi
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>   0x0000000000400f56 &lt;+19&gt;:    mov    $0x0,%eax
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>   0x0000000000400f5b &lt;+24&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>   0x0000000000400f60 &lt;+29&gt;:    cmp    $0x1,%eax
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>   0x0000000000400f63 &lt;+32&gt;:    jg     0x400f6a &lt;phase_3+39&gt;
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>   0x0000000000400f65 &lt;+34&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>   0x0000000000400f6a &lt;+39&gt;:    cmpl   $0x7,0x8(%rsp)
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>   0x0000000000400f6f &lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>   //compare the rsp with 0x7, if above will just explode the bomb
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>   0x0000000000400f71 &lt;+46&gt;:    mov    0x8(%rsp),%eax
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>   0x0000000000400f75 &lt;+50&gt;:    jmpq   *0x402470(,%rax,8)
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>   // jump table
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>   (gdb) x/8gx 0x402470
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>0x402470:       0x0000000000400f7c      0x0000000000400fb9
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>0x402480:       0x0000000000400f83      0x0000000000400f8a
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>0x402490:       0x0000000000400f91      0x0000000000400f98
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>0x4024a0:       0x0000000000400f9f      0x0000000000400fa6
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>, so if the first int is 0, jump to 0x0000000000400f7c, store 0xcf and compare with 2nd int. 0xcf = (CF)₁₆ = (12 × 16¹) + (15 × 16⁰) = 207
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>   0x0000000000400f7c &lt;+57&gt;:    mov    $0xcf,%eax
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>   0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>   0x0000000000400f83 &lt;+64&gt;:    mov    $0x2c3,%eax
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>   0x0000000000400f88 &lt;+69&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>   0x0000000000400f8a &lt;+71&gt;:    mov    $0x100,%eax
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>   0x0000000000400f8f &lt;+76&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>   0x0000000000400f91 &lt;+78&gt;:    mov    $0x185,%eax
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>   0x0000000000400f96 &lt;+83&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>   0x0000000000400f98 &lt;+85&gt;:    mov    $0xce,%eax
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>   0x0000000000400f9d &lt;+90&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>   0x0000000000400f9f &lt;+92&gt;:    mov    $0x2aa,%eax
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>   0x0000000000400fa4 &lt;+97&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>   0x0000000000400fa6 &lt;+99&gt;:    mov    $0x147,%eax
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>   0x0000000000400fab &lt;+104&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>   0x0000000000400fad &lt;+106&gt;:   callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>   0x0000000000400fb2 &lt;+111&gt;:   mov    $0x0,%eax
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>   0x0000000000400fb7 &lt;+116&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>   0x0000000000400fb9 &lt;+118&gt;:   mov    $0x137,%eax
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>   0x0000000000400fbe &lt;+123&gt;:   cmp    0xc(%rsp),%eax
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>   0x0000000000400fc2 &lt;+127&gt;:   je     0x400fc9 &lt;phase_3+134&gt;
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>   0x0000000000400fc4 &lt;+129&gt;:   callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>   0x0000000000400fc9 &lt;+134&gt;:   add    $0x18,%rsp
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>   0x0000000000400fcd &lt;+138&gt;:   retq   
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>End of assembler dump.
</span></code></pre></div>
<h4 id="jump-table">Jump Table</h4>
<p><img alt="" src="../CSAPP.assets/image-20240531170237069.png" /></p>
<p><img alt="image-20240531170245463" src="../CSAPP.assets/image-20240531170245463.png" /></p>
<h4 id="ans_2">Ans:</h4>
<p>0 207</p>
<h3 id="phase_4">Phase_4</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Dump of assembler code for function phase_4:
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>   0x000000000040100c &lt;+0&gt;:     sub    $0x18,%rsp
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>   0x0000000000401010 &lt;+4&gt;:     lea    0xc(%rsp),%rcx   ;2nd = 0xc(%rsp)
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>   0x0000000000401015 &lt;+9&gt;:     lea    0x8(%rsp),%rdx   ;1st= 0x8(%rsp)
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>   0x000000000040101a &lt;+14&gt;:    mov    $0x4025cf,%esi   ;0x4025cf:       &quot;%d %d&quot;
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>   0x000000000040101f &lt;+19&gt;:    mov    $0x0,%eax        
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>   0x0000000000401024 &lt;+24&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>   0x0000000000401029 &lt;+29&gt;:    cmp    $0x2,%eax    expect 2ints
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>   0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>   0x000000000040102e &lt;+34&gt;:    cmpl   $0xe,0x8(%rsp)       ;0x8(%rsp)= 1st &lt;= 14
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;    ;jump if below 
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>   0x0000000000401035 &lt;+41&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>   0x000000000040103a &lt;+46&gt;:    mov    $0xe,%edx        ;edx = 14
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>   0x000000000040103f &lt;+51&gt;:    mov    $0x0,%esi        ;esi = 0
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>   0x0000000000401044 &lt;+56&gt;:    mov    0x8(%rsp),%edi   ;edi = 1st &lt;= 14
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>   0x0000000000401048 &lt;+60&gt;:    callq  0x400fce &lt;func4&gt; 
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>   0x000000000040104d &lt;+65&gt;:    test   %eax,%eax        ; expeact eax to be 0, one case if edi =6
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>   0x000000000040104f &lt;+67&gt;:    jne    0x401058 &lt;phase_4+76&gt;    //jump not !eq/!zero
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>   0x0000000000401051 &lt;+69&gt;:    cmpl   $0x0,0xc(%rsp)       ; cmp 0 2nd
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;    ;solve if euqal, so 2nd =0
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>   0x0000000000401058 &lt;+76&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>   0x000000000040105d &lt;+81&gt;:    add    $0x18,%rsp
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>   0x0000000000401061 &lt;+85&gt;:    retq   
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>End of assembler dump.
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>Dump of assembler code for function func4: (edi = x, esi =0, edx = 14)
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>   0x0000000000400fce &lt;+0&gt;:     sub    $0x8,%rsp
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>   0x0000000000400fd2 &lt;+4&gt;:     mov    %edx,%eax ;eax = 14
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>   0x0000000000400fd4 &lt;+6&gt;:     sub    %esi,%eax ;eax = 14 - 0
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>   0x0000000000400fd6 &lt;+8&gt;:     mov    %eax,%ecx ;ecx = 14
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>   0x0000000000400fd8 &lt;+10&gt;:    shr    $0x1f,%ecx ; ecx = 0
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>   //shr -&gt; logical shift by index ecx
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>   0x0000000000400fdb &lt;+13&gt;:    add    %ecx,%eax  ;eax = 0 + 14
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>   0x0000000000400fdd &lt;+15&gt;:    sar    %eax ; eax = 1110 &gt;&gt; 1 = 111 = 7
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>   //sar Shift Arithmetic Right. 
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>   // arithmetic shift will maintain the sign bit 
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>   0x0000000000400fdf &lt;+17&gt;:    lea    (%rax,%rsi,1),%ecx   ecx = 6
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>   // addressing mode. ecx = rax + rsi * 1 = 6 +0 * 1= 6
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>   0x0000000000400fe2 &lt;+20&gt;:    cmp    %edi,%ecx    cmp x, 6
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;  ;jump if less or equal
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>   0x0000000000400fe6 &lt;+24&gt;:    lea    -0x1(%rcx),%edx
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>   0x0000000000400fe9 &lt;+27&gt;:    callq  0x400fce &lt;func4&gt;
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>   0x0000000000400fee &lt;+32&gt;:    add    %eax,%eax
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>   0x0000000000400ff2 &lt;+36&gt;:    mov    $0x0,%eax    ;eax =0
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>   0x0000000000400ff7 &lt;+41&gt;:    cmp    %edi,%ecx    ;cmp x, 7    first do lower than greater compare
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;  // jump if greater or equal ; 6 in this case could pass, edi =6
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>   0x0000000000400ffb &lt;+45&gt;:    lea    0x1(%rcx),%esi
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>   0x0000000000400ffe &lt;+48&gt;:    callq  0x400fce &lt;func4&gt;
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>   0x0000000000401003 &lt;+53&gt;:    lea    0x1(%rax,%rax,1),%eax
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>   0x0000000000401007 &lt;+57&gt;:    add    $0x8,%rsp
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>   0x000000000040100b &lt;+61&gt;:    retq   
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>End of assembler dump.
</span></code></pre></div>
<h4 id="ans_3">Ans:</h4>
<p>7 0</p>
<h3 id="phase_5">Phase_5</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>(gdb) disas phase_5
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Dump of assembler code for function phase_5: (rdi is the input string)
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>   0x0000000000401062 &lt;+0&gt;:     push   %rbx     ;save rbx reg   
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>   0x0000000000401063 &lt;+1&gt;:     sub    $0x20,%rsp   ;allocate 32
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>   0x0000000000401067 &lt;+5&gt;:     mov    %rdi,%rbx    ;rbx = rdi (input)
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>   0x000000000040106a &lt;+8&gt;:     mov    %fs:0x28,%rax    ;canary setup, 
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>   0x0000000000401073 &lt;+17&gt;:    mov    %rax,0x18(%rsp)  ;24 rsp = rax
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>   0x0000000000401078 &lt;+22&gt;:    xor    %eax,%eax    ;erase canary
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>   0x000000000040107a &lt;+24&gt;:    callq  0x40131b &lt;string_length&gt; ;from phase_1, calcualte string length
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>   0x000000000040107f &lt;+29&gt;:    cmp    $0x6,%eax    ;expect 6 strings separate with space
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;   ;go to 112
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>   0x0000000000401084 &lt;+34&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>   0x0000000000401089 &lt;+39&gt;:    jmp    0x4010d2 &lt;phase_5+112&gt;
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>   ; loop from the +74, rbx is the input, for(rax=0; rax&lt;=6;rax++)
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>   0x000000000040108b &lt;+41&gt;:    movzbl (%rbx,%rax,1),%ecx   ;ecx = rbx + rax * 1 = rbx = input, rbx is the index of the 6 chars, so each time the rax will increase by 1, and rbx pointer will increment by 1
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>   0x000000000040108f &lt;+45&gt;:    mov    %cl,(%rsp)           ;rsp = 8bit rcx, first char of input into rsp
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>   0x0000000000401092 &lt;+48&gt;:    mov    (%rsp),%rdx          ;rdx = rsp = first char
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>   0x0000000000401096 &lt;+52&gt;:    and    $0xf,%edx            ;edx = 0xf = 0b1111 &amp; first char, expect first to be 9, first can be i or y, second can be o or O
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>;http://sticksandstones.kstrom.com/appen.html, use this link to find docs
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    ;3rd -&gt; n,N
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>   ;4rd -&gt; e, E, u, U
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>   ;5th -&gt; v,F,V
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>   ;6th -&gt; g,G,w,W
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>   0x0000000000401099 &lt;+55&gt;:    movzbl 0x4024b0(%rdx),%edx  ;edx = 0x4024b0 + (rdx)
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>;   (gdb) x/s 0x4024b0
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>;0x4024b0 &lt;array.3449&gt;:  &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>; based on the index of bl, move the first char into edx, use this string to decrept the msg
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>;rdx = 9. edx = f
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>;rdx = 15. edx = l
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>;rdx = 14. edx = y
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>;rdx = 5, edx = e
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>;rdx = 6, edx = r
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>;rdx = 7. edx = s
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>   0x00000000004010a0 &lt;+62&gt;:    mov    %dl,0x10(%rsp,%rax,1)    ;rdx(8bit), 0x10 + rsp + rax*1 = 0x10 + rsp
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>   0x00000000004010a4 &lt;+66&gt;:    add    $0x1,%rax    ;rax = 1
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>   0x00000000004010a8 &lt;+70&gt;:    cmp    $0x6,%rax    ;cmp rax,6
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>   0x00000000004010ac &lt;+74&gt;:    jne    0x40108b &lt;phase_5+41&gt;    ;recursion until it reaches the end
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>   0x00000000004010ae &lt;+76&gt;:    movb   $0x0,0x16(%rsp)      ; 24rsp = 0
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>   0x00000000004010b3 &lt;+81&gt;:    mov    $0x40245e,%esi       ;(gdb) x/s 0x40245e 0x40245e:       &quot;flyers&quot;
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>   0x00000000004010b8 &lt;+86&gt;:    lea    0x10(%rsp),%rdi      ; rdi = 16rsp
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>   0x00000000004010bd &lt;+91&gt;:    callq  0x401338 &lt;strings_not_equal&gt; ;compare the rsi and rdi
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>   0x00000000004010c2 &lt;+96&gt;:    test   %eax,%eax
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>   0x00000000004010c4 &lt;+98&gt;:    je     0x4010d9 &lt;phase_5+119&gt;
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>   0x00000000004010c6 &lt;+100&gt;:   callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>   0x00000000004010cb &lt;+105&gt;:   nopl   0x0(%rax,%rax,1)
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>   0x00000000004010d0 &lt;+110&gt;:   jmp    0x4010d9 &lt;phase_5+119&gt;
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>   0x00000000004010d2 &lt;+112&gt;:   mov    $0x0,%eax    ;eax = 0
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>   0x00000000004010d7 &lt;+117&gt;:   jmp    0x40108b &lt;phase_5+41&gt;    ;jmp to phase_5 + 41
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>   0x00000000004010d9 &lt;+119&gt;:   mov    0x18(%rsp),%rax
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>   0x00000000004010de &lt;+124&gt;:   xor    %fs:0x28,%rax
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>   0x00000000004010e7 &lt;+133&gt;:   je     0x4010ee &lt;phase_5+140&gt;
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>   0x00000000004010e9 &lt;+135&gt;:   callq  0x400b30 &lt;__stack_chk_fail@plt&gt;
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>   0x00000000004010ee &lt;+140&gt;:   add    $0x20,%rsp
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>   0x00000000004010f2 &lt;+144&gt;:   pop    %rbx
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>   0x00000000004010f3 &lt;+145&gt;:   retq   
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>End of assembler dump.
</span></code></pre></div>
<p>Crazy question :&lt;&gt;&lt;&gt;</p>
<h4 id="ans_4">Ans:</h4>
<p>ionevg</p>
<h3 id="phase_6">Phase_6</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>s(gdb) disas phase_6
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Dump of assembler code for function phase_6:
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>   0x00000000004010f4 &lt;+0&gt;:     push   %r14
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>   0x00000000004010f6 &lt;+2&gt;:     push   %r13
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>   0x00000000004010f8 &lt;+4&gt;:     push   %r12
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>   0x00000000004010fa &lt;+6&gt;:     push   %rbp
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>   0x00000000004010fb &lt;+7&gt;:     push   %rbx
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>   0x00000000004010fc &lt;+8&gt;:     sub    $0x50,%rsp   
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>   0x0000000000401100 &lt;+12&gt;:    mov    %rsp,%r13    ;r13 = rsp      ;r13 and rsi can both represent input
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>   0x0000000000401103 &lt;+15&gt;:    mov    %rsp,%rsi    ;rsi = rsp
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>   0x0000000000401106 &lt;+18&gt;:    callq  0x40145c &lt;read_six_numbers&gt;  ;load six inputs from rdi to rsp, see notes from phase_2, index by 4 each           ;rsp = six numbers
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>   0x000000000040110b &lt;+23&gt;:    mov    %rsp,%r14    ;r14 = rsp
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>   0x000000000040110e &lt;+26&gt;:    mov    $0x0,%r12d   ;r12d = 0
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>   0x0000000000401114 &lt;+32&gt;:    mov    %r13,%rbp    ;rbp = r13, rbp=r13 = 2nd int
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>   0x0000000000401117 &lt;+35&gt;:    mov    0x0(%r13),%eax       ;eax = r13 + 0, first number
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>   0x000000000040111b &lt;+39&gt;:    sub    $0x1,%eax    ;eax = eax - 1
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>   0x000000000040111e &lt;+42&gt;:    cmp    $0x5,%eax    ;cmp eax,5      eax &lt;= 5, from previouse, eax &lt;= 6 
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>   0x0000000000401121 &lt;+45&gt;:    jbe    0x401128 &lt;phase_6+52&gt;    ;jmp if eax is below or equal to 5, has to
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>   0x0000000000401123 &lt;+47&gt;:    callq  0x40143a &lt;explode_bomb&gt;  
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>   0x0000000000401128 &lt;+52&gt;:    add    $0x1,%r12d   ;r12d = r12d + 1 = 0 + 1
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>   0x000000000040112c &lt;+56&gt;:    cmp    $0x6,%r12d   ;cmp 6, r12d(1)
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>   0x0000000000401130 &lt;+60&gt;:    je     0x401153 &lt;phase_6+95&gt;    ;jump if equal, not equal for the first
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>   0x0000000000401132 &lt;+62&gt;:    mov    %r12d,%ebx   ;ebx = r12d = 1
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>   ;another loop to verify no repeated ints
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>   0x0000000000401135 &lt;+65&gt;:    movslq %ebx,%rax    ;rax = ebx = 1, rax=ebx=2
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>   ;movslq, movsbl src, dst byte to int, sign-extend, if the ebx -&gt; convert to single byte is 1, extend the sign bit
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>   0x0000000000401138 &lt;+68&gt;:    mov    (%rsp,%rax,4),%eax   ;eax = rsp + rax*4 = rsp + 1*4, move the input string right by 1, index will increase again now
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>   0x000000000040113b &lt;+71&gt;:    cmp    %eax,0x0(%rbp)   ;
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>   0x000000000040113e &lt;+74&gt;:    jne    0x401145 &lt;phase_6+81&gt;    ;can not be equal, 1st and 2nd
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>   0x0000000000401140 &lt;+76&gt;:    callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>   0x0000000000401145 &lt;+81&gt;:    add    $0x1,%ebx    ;ebx = ebx + 1
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>   0x0000000000401148 &lt;+84&gt;:    cmp    $0x5,%ebx    ;cmp 5,ebx + 1
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>   0x000000000040114b &lt;+87&gt;:    jle    0x401135 &lt;phase_6+65&gt;    ;jmp if ebx &lt;= 5
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>   0x000000000040114d &lt;+89&gt;:    add    $0x4,%r13    ;r13 +4, move to 2nd int
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>   0x0000000000401151 &lt;+93&gt;:    jmp    0x401114 &lt;phase_6+32&gt; ;
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>   ;32 - 93: go from each input, compare with make sure not higher than 6, and each int it will compare if it is the same as the rest of the ints. Make sure no repeated value appear, then in this case. the input 0,1,2,3,4,5,6
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>   0x0000000000401153 &lt;+95&gt;:    lea    0x18(%rsp),%rsi  ;load last int to rsi
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>   0x0000000000401158 &lt;+100&gt;:   mov    %r14,%rax    ;rax = r14 = first int index
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>   0x000000000040115b &lt;+103&gt;:   mov    $0x7,%ecx    ;ecx = 0x7
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>   0x0000000000401160 &lt;+108&gt;:   mov    %ecx,%edx    ;edx = ecx = 0x7
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>   0x0000000000401162 &lt;+110&gt;:   sub    (%rax),%edx  ; edx = edx - rax = 7 - 1st int
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>   0x0000000000401164 &lt;+112&gt;:   mov    %edx,(%rax)  ; (rax) = edx
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>   0x0000000000401166 &lt;+114&gt;:   add    $0x4,%rax    ; (rax) = rax + 0x4
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>   0x000000000040116a &lt;+118&gt;:   cmp    %rsi,%rax    ; cmp last_int, rax= (7-1st int) + 0x4 = 11 - 1st int, compare the last int with the 
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>   0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;   ;
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>   ;95 - 121: loop six values, use 7 to subtrace each int
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>   0x000000000040116f &lt;+123&gt;:   mov    $0x0,%esi    ;esi = 0
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>   0x0000000000401174 &lt;+128&gt;:   jmp    0x401197 &lt;phase_6+163&gt;
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>   0x0000000000401176 &lt;+130&gt;:   mov    0x8(%rdx),%rdx; rdx = rdx +8 = -32
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>   ;0x6032d8 &lt;node1+8&gt;:     &quot;\340\062`&quot; , this is octal format, convert it to decimal = 224, 50,
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>   0x000000000040117a &lt;+134&gt;:   add    $0x1,%eax ;eax = 2
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>   0x000000000040117d &lt;+137&gt;:   cmp    %ecx,%eax    ;cmp 2nd int with 2, if not equal, keep adding 1 until it equals the 2nd int. 
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>   0x000000000040117f &lt;+139&gt;:   jne    0x401176 &lt;phase_6+130&gt;
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>   0x0000000000401181 &lt;+141&gt;:   jmp    0x401188 &lt;phase_6+148&gt;   ;if equal, eax = ecx = 2nd int
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>   ;from 169
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>   0x0000000000401183 &lt;+143&gt;:   mov    $0x6032d0,%edx   ;if the value is 6 , edx = 76
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>   0x0000000000401188 &lt;+148&gt;:   mov    %rdx,0x20(%rsp,%rsi,2)   ;rsp + 2*rsi + 20 = 1st int + 20 = move 1 to the last int
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>   0x000000000040118d &lt;+153&gt;:   add    $0x4,%rsi    ;rsi = 0 +4
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>   0x0000000000401191 &lt;+157&gt;:   cmp    $0x18,%rsi   ;cmp if it reaches the end,
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>   0x0000000000401195 &lt;+161&gt;:   je     0x4011ab &lt;phase_6+183&gt; ;if not cont,
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>   0x0000000000401197 &lt;+163&gt;:   mov    (%rsp,%rsi,1),%ecx ;rsp = (1st int + 0 *1) = ecx = 1st int, next loop go to 2nd int
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>   0x000000000040119a &lt;+166&gt;:   cmp    $0x1,%ecx    ;cmp 1, ecx, if it is not 6, it should be higher here
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>   0x000000000040119d &lt;+169&gt;:   jle    0x401183 &lt;phase_6+143&gt;   ;jmp if ecx &lt; 1, guess only if the input is 6 in this case.
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>   0x000000000040119f &lt;+171&gt;:   mov    $0x1,%eax    ;eax = 1
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>   0x00000000004011a4 &lt;+176&gt;:   mov    $0x6032d0,%edx   ;edx = 1
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>   0x00000000004011a9 &lt;+181&gt;:   jmp    0x401176 &lt;phase_6+130&gt;
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>   ;store each int into a node, 1st int -&gt;node1, 2nd int -&gt;node2, the node number corresponds the same value of the converted input
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>   0x00000000004011ab &lt;+183&gt;:   mov    0x20(%rsp),%rbx  ;   rbx = 1st int node number
</span><span id="__span-9-80"><a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>   0x00000000004011b0 &lt;+188&gt;:   lea    0x28(%rsp),%rax  ;   rax = 2nd int node number
</span><span id="__span-9-81"><a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>   0x00000000004011b5 &lt;+193&gt;:   lea    0x50(%rsp),%rsi  ;end node
</span><span id="__span-9-82"><a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>   0x00000000004011ba &lt;+198&gt;:   mov    %rbx,%rcx        ;rcx = rbx = 2nd int node
</span><span id="__span-9-83"><a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>
</span><span id="__span-9-84"><a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>   0x00000000004011bd &lt;+201&gt;:   mov    (%rax),%rdx      ;rdx = value at node 2nd number 2, to rdx
</span><span id="__span-9-85"><a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>   0x00000000004011c0 &lt;+204&gt;:   mov    %rdx,0x8(%rcx)   ;rcx = rbx, load the value of 2
</span><span id="__span-9-86"><a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>   0x00000000004011c4 &lt;+208&gt;:   add    $0x8,%rax        ;rax increase by 1 byte
</span><span id="__span-9-87"><a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>   0x00000000004011c8 &lt;+212&gt;:   cmp    %rsi,%rax        ;
</span><span id="__span-9-88"><a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>   0x00000000004011cb &lt;+215&gt;:   je     0x4011d2 &lt;phase_6+222&gt;
</span><span id="__span-9-89"><a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>   0x00000000004011cd &lt;+217&gt;:   mov    %rdx,%rcx        ;
</span><span id="__span-9-90"><a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>   0x00000000004011d0 &lt;+220&gt;:   jmp    0x4011bd &lt;phase_6+201&gt;
</span><span id="__span-9-91"><a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a> ; change the ptr orders based on the storing order.  i think the purpose here is for the below steps, instead of using the rsp + 20/28, it can use pointer arithmatic to plus 8 since we reassign the order of the linked list.
</span><span id="__span-9-92"><a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>
</span><span id="__span-9-93"><a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>   0x00000000004011d2 &lt;+222&gt;:   movq   $0x0,0x8(%rdx) ;0 to the end?
</span><span id="__span-9-94"><a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>   0x00000000004011da &lt;+230&gt;:   mov    $0x5,%ebp      ;rbp =  5
</span><span id="__span-9-95"><a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>
</span><span id="__span-9-96"><a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>   0x00000000004011df &lt;+235&gt;:   mov    0x8(%rbx),%rax   ;2nd node into rax
</span><span id="__span-9-97"><a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>   0x00000000004011e3 &lt;+239&gt;:   mov    (%rax),%eax      ;eax = value
</span><span id="__span-9-98"><a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>   0x00000000004011e5 &lt;+241&gt;:   cmp    %eax,(%rbx)      ;rbx is the first node, cmp the node value
</span><span id="__span-9-99"><a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>   0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;   ;1st &gt; 2nd, else explode bomb
</span><span id="__span-9-100"><a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>   0x00000000004011e9 &lt;+245&gt;:   callq  0x40143a &lt;explode_bomb&gt;
</span><span id="__span-9-101"><a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>   0x00000000004011ee &lt;+250&gt;:   mov    0x8(%rbx),%rbx   ;rbx index by 1, now go to 2nd
</span><span id="__span-9-102"><a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>   0x00000000004011f2 &lt;+254&gt;:   sub    $0x1,%ebp        ;4
</span><span id="__span-9-103"><a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>   0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;   ; need zf = 0
</span><span id="__span-9-104"><a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>   ;basically compare the value in the node index, increase the node index by 8 every time, make sure the previous one is always greater, sort in descending order
</span><span id="__span-9-105"><a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>
</span><span id="__span-9-106"><a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a> ;(gdb) x/24wx 0x6032d0
</span><span id="__span-9-107"><a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>0x6032d0 &lt;node1&gt;:       0x0000014c =  332    0x00000001      0x006032e0      0x00000000
</span><span id="__span-9-108"><a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>0x6032e0 &lt;node2&gt;:       0x000000a8  = 168   0x00000002      0x006032f0      0x00000000
</span><span id="__span-9-109"><a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>0x6032f0 &lt;node3&gt;:       0x0000039c =924     0x00000003      0x00603300      0x00000000
</span><span id="__span-9-110"><a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>0x603300 &lt;node4&gt;:       0x000002b3  = 691   0x00000004      0x00603310      0x00000000
</span><span id="__span-9-111"><a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>0x603310 &lt;node5&gt;:       0x000001dd = 477    0x00000005      0x00603320      0x00000000
</span><span id="__span-9-112"><a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>0x603320 &lt;node6&gt;:       0x000001bb  = 443    0x00000006      0x00000000      0x00000000
</span><span id="__span-9-113"><a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>
</span><span id="__span-9-114"><a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a> ;descending order. 3-&gt;4-&gt;5-&gt;6-&gt;1-&gt;2, and because we revert it by subtracting from 7, have to revert back
</span><span id="__span-9-115"><a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>
</span><span id="__span-9-116"><a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a> ;4 3 2 1 6 5
</span><span id="__span-9-117"><a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>
</span><span id="__span-9-118"><a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>   0x00000000004011f7 &lt;+259&gt;:   add    $0x50,%rsp       ;
</span><span id="__span-9-119"><a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>   0x00000000004011fb &lt;+263&gt;:   pop    %rbx
</span><span id="__span-9-120"><a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>   0x00000000004011fc &lt;+264&gt;:   pop    %rbp
</span><span id="__span-9-121"><a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>   0x00000000004011fd &lt;+265&gt;:   pop    %r12
</span><span id="__span-9-122"><a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>   0x00000000004011ff &lt;+267&gt;:   pop    %r13
</span><span id="__span-9-123"><a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>   0x0000000000401201 &lt;+269&gt;:   pop    %r14
</span><span id="__span-9-124"><a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>   0x0000000000401203 &lt;+271&gt;:   retq   
</span><span id="__span-9-125"><a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>End of assembler dump.
</span></code></pre></div>
<p>Notes:</p>
<p>In x86-64 assembly, registers like <code>%eax</code> do not have a fixed memory address because they are part of the CPU's internal state. Instead, <code>%eax</code> is a 32-bit register within the CPU that can hold a value. When you perform an operation like <code>mov 0x0(%r13), %eax</code>, you are transferring a value from memory into the <code>%eax</code> register, not an address.</p>
<p><strong>Storing Values</strong>: <code>RAX</code> can hold any integer value, which can be used for arithmetic operations, comparisons, or as a general-purpose register.</p>
<p><strong>Pointer/Address Holder</strong>: <code>RAX</code> can store memory addresses, allowing it to be used as a pointer to access or manipulate data in memory.</p>
<h4 id="ans_5">Ans:</h4>
<p>4 3 2 1 6 5</p>
<p><img alt="image-20240607022420435" src="../CSAPP.assets/image-20240607022420435.png" /> let's goooo</p>
<h2 id="lab3-attack-labcode-injection-and-rop-attack">Lab3 - Attack lab(Code Injection and ROP attack)</h2>
<p><img alt="image-20240610013516973" src="../CSAPP.assets/image-20240610013516973.png" /></p>
<p><img alt="image-20240610013526450" src="../CSAPP.assets/image-20240610013526450.png" /></p>
<p><img alt="image-20240610013535692" src="../CSAPP.assets/image-20240610013535692.png" /></p>
<h3 id="understanding-the-rdi-register-and-parameter-passing">Understanding the <code>rdi</code> Register and Parameter Passing</h3>
<ol>
<li><strong>Scalar Values (e.g., integers, floats):</strong></li>
<li>If the parameter is a scalar value (such as an integer or a float), the actual value is stored directly in the <code>rdi</code> register.</li>
<li>For example, if you pass an integer value <code>42</code> to a function, <code>rdi</code> will contain <code>42</code>.</li>
<li><strong>Pointers (e.g., strings, arrays, structs):</strong></li>
<li>If the parameter is a pointer (such as a string, array, or a struct), the <code>rdi</code> register will contain the address of the memory location where the actual data is stored.</li>
<li>For example, if you pass a string <code>"hello"</code> to a function, <code>rdi</code> will contain the address of the first character of the string in memory.</li>
</ol>
<h3 id="phase4">Phase4</h3>
<p>ROP attack -&gt; in the code instruction set, each code segment that ends with the return (c3) can be named as gadget.</p>
<p>To design, the asm code can be followed from the previous phase2.</p>
<p>usual way is we can move the cookie to the stack, and move the stack to the rdi, and push the function address and return. In this case, since we are going to use the code section, we can use rax to pass the cookie.</p>
<p>So the ASM will be:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>pop rax ;58
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>ret
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>//pass the cookie
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>mov rax, rdi    ;48 89 c7
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>ret
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>//call the function
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>00000000004019a7 &lt;addval_219&gt;:
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  4019a7:   8d 87 51 73 58 90       lea    -0x6fa78caf(%rdi),%eax
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>  4019ad:   c3                      retq   
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>00000000004019a0 &lt;addval_273&gt;:
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>  4019a0:   8d 87 48 89 c7 c3       lea    -0x3c3876b8(%rdi),%eax
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>  4019a6:   c3                      retq   
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>;4019a7 + 4 = 4019ab // ab 19 40
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>;pass the cookie as rax // fa 97 b9 59
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>;move rax,rdi // 4019a2 // a2 19 40
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>;then push the function of touch2 //ec 17 40
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>./hex2raw &lt; 4ansmyown.txt | ./rtarget -q
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>cmd to run
</span></code></pre></div>
<p><strong>Summary:</strong></p>
<ul>
<li>Starting the index at an address means the disassembler will interpret the bytes from that point as a complete instruction.</li>
<li>The disassembler decodes each instruction in sequence until it reaches the end of the function or another stopping point.</li>
<li>For <code>mov</code> or any other instructions, it decodes the entire instruction set starting from the given address.</li>
</ul>
<p><strong>Important Points from lab manual:</strong></p>
<ul>
<li>Your exploit string must not contain byte value 0x0a at any intermediate position, since this is the ASCII code for newline (‘\n’). When Gets encounters this byte, it will assume you intended to terminate the string. </li>
<li>HEX2RAW expects two-digit hex values separated by one or more white spaces. So if you want to create a byte with a hex value of 0, you need to write it as 00. To create the word 0xdeadbeef you should pass “ef be ad de” to HEX2RAW (note the reversal required for little-endian byte ordering).</li>
</ul>
<h3 id="phase5">Phase5</h3>
<p>The cookie in ASCII is: <code>35 39 62 39 39 37 66 61 00</code></p>
<p>Old way is to pass the cookie as an rax into the register and move it into the stack memory address and called the memory address.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>\\\from phase_3, 0000000000000000 &lt;.text&gt;:
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>   0:   48 c7 c7 a8 dc 61 55    mov    $0x5561dca8,%rdi
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>   7:   68 fa 18 40 00          pushq  $0x4018fa
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>   c:   c3                      retq   
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>48 c7 c7 a8 dc 61 55 68
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>fa 18 40 00 c3 00 00 00
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>00 00 00 00 00 00 00 00
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>00 00 00 00 00 00 00 00
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>00 00 00 00 00 00 00 00 
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>78 dc 61 55 00 00 00 00     ;the stack address of the previous
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>35 39 62 39 39 37 66 61     ;store this cookie on the test stack
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>00
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Idea is to make sure there is enough stack address that was able to get used in this case
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>;use below instructions to load the stack address of the rdi, rsi will be used to set as an offset
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>000000000000006a &lt;add_xy&gt;:
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>  6a:   f3 0f 1e fa             endbr64 
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>  6e:   48 8d 04 37             lea    (%rdi,%rsi,1),%rax
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>  72:   c3                      retq   
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>; From the farm.asm file, only the instruction movl ecx,esi is being found, so we can only use this and pass around the registers
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>; next find only the 
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>mov edx, ecx
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>mov eax, edx
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>// after adding bias.
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>pop rax,
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>mov rax, rdi    ;rdi will be the top address of the stack on test
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>mov rsp, rax
</span></code></pre></div>
<p><img alt="image-20240617002317736" src="../CSAPP.assets/image-20240617002317736.png" /></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>00 00 00 00 00 00 00 00 00 00
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>00 00 00 00 00 00 00 00 00 00
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>00 00 00 00 00 00 00 00 00 00
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>00 00 00 00 00 00 00 00 00 00
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>06 1a 40 00 00 00 00 00 
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>a2 19 40 00 00 00 00 00 
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>cc 19 40 00 00 00 00 00 
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>48 00 00 00 00 00 00 00 
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>dd 19 40 00 00 00 00 00 
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>70 1a 40 00 00 00 00 00 
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>13 1a 40 00 00 00 00 00 
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>d6 19 40 00 00 00 00 00 
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>a2 19 40 00 00 00 00 00 
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>fa 18 40 00 00 00 00 00 
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>35 39 62 39 39 37 66 61 00
</span></code></pre></div>
<h3 id="references">References:</h3>
<p>https://www.jianshu.com/p/db731ca57342</p>
<p>https://zhuanlan.zhihu.com/p/60724948</p>
<p>https://blog.liblaf.me/2022/course-work/csapp/attack-lab/2022-04-23-phase-5.html</p>
<h2 id="lab4">Lab4</h2>
<p><img alt="image-20240623201924113" src="../CSAPP.assets/image-20240623201924113.png" /></p>
<h3 id="part1">Part1</h3>
<p>Idea is to design sets -&gt; cache_lines, dynamic allocate memory</p>
<p>Since we can only know the 2d array size after getting the size array from command line inputs, we have to dynamic allocate memory in this case.</p>
<h3 id="struct-and-typedef-in-c">struct and typedef in c</h3>
<div class="language-c highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">//Struct:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">struct_name</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="c1">// Member variables (also called fields or members)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="n">type1</span><span class="w"> </span><span class="n">member1</span><span class="p">;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="n">type2</span><span class="w"> </span><span class="n">member2</span><span class="p">;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="n">typeN</span><span class="w"> </span><span class="n">memberN</span><span class="p">;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">};</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1">// Define a structure named &#39;Person&#39; with members name, age, and height</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="p">};</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">   </span><span class="c1">// code</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="p">}</span><span class="w"> </span><span class="n">person1</span><span class="p">,</span><span class="w"> </span><span class="n">person2</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="n">In</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">cases</span><span class="p">,</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="c1">//person1 and person2 are struct Person variables</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="c1">//p[] is a struct Person array of size 20.</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="c1">// Declaring variables of type &#39;struct Person&#39;</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="n">person1</span><span class="p">,</span><span class="w"> </span><span class="n">person2</span><span class="p">;</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="c1">//typedef</span>
</span></code></pre></div>
<p>https://www.programiz.com/c-programming/c-structures</p>
<p><img alt="image-20240624021518787" src="../CSAPP.assets/image-20240624021518787.png" /></p>
<p><img alt="image-20240624000353910" src="../CSAPP.assets/image-20240624000353910.png" /></p>
<h3 id="lru-counter-logic">LRU counter logic</h3>
<p>Initialize LRU counter to 0 -&gt; valid bit is 0; free</p>
<p>how to determine, if there is a find</p>
<p>loop through each line to find smallest, if it is 0, directly assigned</p>
<p><img alt="image-20240624171008548" src="../CSAPP.assets/image-20240624171008548.png" /></p>
<p>booo, ez</p>
<p>Full Code</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cachelab.h&quot;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;getopt.h&gt;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="cp">#define uint_32max 1 &lt;&lt; 31;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="c1">// finish the block of getting the command arguments</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="k">struct</span><span class="w"> </span><span class="nc">cache_line</span><span class="p">{</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">valid_bit</span><span class="p">;</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">LRU_counter</span><span class="p">;</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="p">}</span><span class="n">cache_line</span><span class="p">;</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="k">struct</span><span class="w"> </span><span class="nc">result</span><span class="p">{</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">hit</span><span class="p">;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">miss</span><span class="p">;</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">eviction</span><span class="p">;</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="p">}</span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">cache_line</span><span class="w"> </span><span class="o">*</span><span class="n">cache_line_entry</span><span class="p">;</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="k">typedef</span><span class="w"> </span><span class="n">cache_line_entry</span><span class="w"> </span><span class="o">*</span><span class="n">cache_set_entry</span><span class="p">;</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="kt">void</span><span class="w"> </span><span class="nf">usage</span><span class="p">(){</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: ./csim-ref [-hv] -s &lt;num&gt; -E &lt;num&gt; -b &lt;num&gt; -t &lt;file&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Options:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -h         Print this help message.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -v         Optional verbose flag.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -s &lt;num&gt;   Number of set index bits.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -E &lt;num&gt;   Number of lines per set.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -b &lt;num&gt;   Number of block offset bits.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  -t &lt;file&gt;  Trace file.</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Examples:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  linux&gt;  ./csim-ref -s 4 -E 1 -b 4 -t traces/yi.trace</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  linux&gt;  ./csim-ref -v -s 8 -E 2 -b 4 -t traces/yi.trace</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="p">}</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="kt">void</span><span class="w"> </span><span class="nf">update_result</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">I</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="n">cache_set_entry</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">set_index_cast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sets</span><span class="p">)</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">set_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">set_index_cast</span><span class="p">;</span>
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">sets</span><span class="o">+</span><span class="n">b</span><span class="p">);</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">evict_true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">smallest_LRU</span><span class="o">=</span><span class="w"> </span><span class="n">uint_32max</span><span class="p">;</span><span class="w"> </span><span class="c1">//first initliaze, </span>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">replaced_LRU_index</span><span class="p">;</span>
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">largest_LRU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="w">    </span><span class="c1">// printf(&quot;%d %d \n&quot;, set_index, tag);</span>
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="w">    </span><span class="c1">// load or store, trigger once</span>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">E</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">valid_bit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="w">            </span><span class="c1">//if there is empty line, no need to evict</span>
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="w">            </span><span class="n">evict_true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w">            </span><span class="n">replaced_LRU_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">LRU_counter</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">smallest_LRU</span><span class="p">){</span>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="w">                </span><span class="n">smallest_LRU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">LRU_counter</span><span class="p">;</span>
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="w">                </span><span class="n">replaced_LRU_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">E</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">LRU_counter</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">largest_LRU</span><span class="p">){</span>
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w">            </span><span class="n">largest_LRU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">LRU_counter</span><span class="p">;</span>
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a>
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">E</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">valid_bit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="w">                </span><span class="c1">// found</span>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">hit</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="p">)</span>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a><span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; hit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="p">)</span>
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; hit&quot;</span><span class="p">);</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="w">                </span><span class="c1">// tmr question, how to handle LRU</span>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a><span class="w">                </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">LRU_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">largest_LRU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="w">    </span><span class="c1">//didn&#39;t find, miss++ and determine if need to evict</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a>
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">miss</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a>
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">evict_true</span><span class="p">)</span>
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="p">){</span>
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; miss eviction&quot;</span><span class="p">);</span>
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; miss eviction</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a>
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a>
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">eviction</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">valid_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-121"><a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">LRU_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">largest_LRU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-122"><a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-123"><a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-17-124"><a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-125"><a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-126"><a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="p">){</span>
</span><span id="__span-17-127"><a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; miss&quot;</span><span class="p">);</span>
</span><span id="__span-17-128"><a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-17-129"><a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; miss</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-17-130"><a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-131"><a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-132"><a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a>
</span><span id="__span-17-133"><a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a>
</span><span id="__span-17-134"><a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
</span><span id="__span-17-135"><a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">valid_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-136"><a id="__codelineno-17-136" name="__codelineno-17-136" href="#__codelineno-17-136"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">set_index</span><span class="p">][</span><span class="n">replaced_LRU_index</span><span class="p">].</span><span class="n">LRU_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">largest_LRU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-137"><a id="__codelineno-17-137" name="__codelineno-17-137" href="#__codelineno-17-137"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-138"><a id="__codelineno-17-138" name="__codelineno-17-138" href="#__codelineno-17-138"></a>
</span><span id="__span-17-139"><a id="__codelineno-17-139" name="__codelineno-17-139" href="#__codelineno-17-139"></a><span class="p">}</span>
</span><span id="__span-17-140"><a id="__codelineno-17-140" name="__codelineno-17-140" href="#__codelineno-17-140"></a>
</span><span id="__span-17-141"><a id="__codelineno-17-141" name="__codelineno-17-141" href="#__codelineno-17-141"></a><span class="kt">void</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="n">cache_set_entry</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-142"><a id="__codelineno-17-142" name="__codelineno-17-142" href="#__codelineno-17-142"></a><span class="w">    </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">pFile</span><span class="p">;</span>
</span><span id="__span-17-143"><a id="__codelineno-17-143" name="__codelineno-17-143" href="#__codelineno-17-143"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">identifier</span><span class="p">;</span>
</span><span id="__span-17-144"><a id="__codelineno-17-144" name="__codelineno-17-144" href="#__codelineno-17-144"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">address</span><span class="p">;</span><span class="w"> </span><span class="c1">//unsigned int</span>
</span><span id="__span-17-145"><a id="__codelineno-17-145" name="__codelineno-17-145" href="#__codelineno-17-145"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
</span><span id="__span-17-146"><a id="__codelineno-17-146" name="__codelineno-17-146" href="#__codelineno-17-146"></a>
</span><span id="__span-17-147"><a id="__codelineno-17-147" name="__codelineno-17-147" href="#__codelineno-17-147"></a>
</span><span id="__span-17-148"><a id="__codelineno-17-148" name="__codelineno-17-148" href="#__codelineno-17-148"></a><span class="w">    </span><span class="n">pFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span id="__span-17-149"><a id="__codelineno-17-149" name="__codelineno-17-149" href="#__codelineno-17-149"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">fscanf</span><span class="p">(</span><span class="n">pFile</span><span class="p">,</span><span class="s">&quot; %c %x,%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">identifier</span><span class="p">,</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="o">&amp;</span><span class="n">size</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-17-150"><a id="__codelineno-17-150" name="__codelineno-17-150" href="#__codelineno-17-150"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-151"><a id="__codelineno-17-151" name="__codelineno-17-151" href="#__codelineno-17-151"></a><span class="w">        </span><span class="cm">/* code */</span>
</span><span id="__span-17-152"><a id="__codelineno-17-152" name="__codelineno-17-152" href="#__codelineno-17-152"></a>
</span><span id="__span-17-153"><a id="__codelineno-17-153" name="__codelineno-17-153" href="#__codelineno-17-153"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">identifier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;L&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">==</span><span class="sc">&#39;S&#39;</span><span class="p">){</span>
</span><span id="__span-17-154"><a id="__codelineno-17-154" name="__codelineno-17-154" href="#__codelineno-17-154"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-155"><a id="__codelineno-17-155" name="__codelineno-17-155" href="#__codelineno-17-155"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c %x,%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">identifier</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
</span><span id="__span-17-156"><a id="__codelineno-17-156" name="__codelineno-17-156" href="#__codelineno-17-156"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-157"><a id="__codelineno-17-157" name="__codelineno-17-157" href="#__codelineno-17-157"></a>
</span><span id="__span-17-158"><a id="__codelineno-17-158" name="__codelineno-17-158" href="#__codelineno-17-158"></a><span class="w">            </span><span class="n">update_result</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-17-159"><a id="__codelineno-17-159" name="__codelineno-17-159" href="#__codelineno-17-159"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">identifier</span><span class="w"> </span><span class="o">==</span><span class="sc">&#39;M&#39;</span><span class="p">){</span>
</span><span id="__span-17-160"><a id="__codelineno-17-160" name="__codelineno-17-160" href="#__codelineno-17-160"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-17-161"><a id="__codelineno-17-161" name="__codelineno-17-161" href="#__codelineno-17-161"></a><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c %x,%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">identifier</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
</span><span id="__span-17-162"><a id="__codelineno-17-162" name="__codelineno-17-162" href="#__codelineno-17-162"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-163"><a id="__codelineno-17-163" name="__codelineno-17-163" href="#__codelineno-17-163"></a><span class="w">            </span><span class="n">update_result</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-17-164"><a id="__codelineno-17-164" name="__codelineno-17-164" href="#__codelineno-17-164"></a><span class="w">            </span><span class="n">update_result</span><span class="p">(</span><span class="sc">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-17-165"><a id="__codelineno-17-165" name="__codelineno-17-165" href="#__codelineno-17-165"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-166"><a id="__codelineno-17-166" name="__codelineno-17-166" href="#__codelineno-17-166"></a>
</span><span id="__span-17-167"><a id="__codelineno-17-167" name="__codelineno-17-167" href="#__codelineno-17-167"></a><span class="w">        </span><span class="c1">// doing actual code here</span>
</span><span id="__span-17-168"><a id="__codelineno-17-168" name="__codelineno-17-168" href="#__codelineno-17-168"></a>
</span><span id="__span-17-169"><a id="__codelineno-17-169" name="__codelineno-17-169" href="#__codelineno-17-169"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-170"><a id="__codelineno-17-170" name="__codelineno-17-170" href="#__codelineno-17-170"></a><span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span><span id="__span-17-171"><a id="__codelineno-17-171" name="__codelineno-17-171" href="#__codelineno-17-171"></a><span class="p">}</span>
</span><span id="__span-17-172"><a id="__codelineno-17-172" name="__codelineno-17-172" href="#__codelineno-17-172"></a>
</span><span id="__span-17-173"><a id="__codelineno-17-173" name="__codelineno-17-173" href="#__codelineno-17-173"></a>
</span><span id="__span-17-174"><a id="__codelineno-17-174" name="__codelineno-17-174" href="#__codelineno-17-174"></a>
</span><span id="__span-17-175"><a id="__codelineno-17-175" name="__codelineno-17-175" href="#__codelineno-17-175"></a>
</span><span id="__span-17-176"><a id="__codelineno-17-176" name="__codelineno-17-176" href="#__codelineno-17-176"></a><span class="n">cache_set_entry</span><span class="w"> </span><span class="nf">cache_init</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sets</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">E</span><span class="p">){</span>
</span><span id="__span-17-177"><a id="__codelineno-17-177" name="__codelineno-17-177" href="#__codelineno-17-177"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">sets</span><span class="p">);</span><span class="w"> </span><span class="c1">// equivalent to 1 &lt;&lt; sets;</span>
</span><span id="__span-17-178"><a id="__codelineno-17-178" name="__codelineno-17-178" href="#__codelineno-17-178"></a><span class="w">    </span><span class="c1">// printf(&quot;%d&quot;, e);</span>
</span><span id="__span-17-179"><a id="__codelineno-17-179" name="__codelineno-17-179" href="#__codelineno-17-179"></a><span class="w">    </span><span class="n">cache_set_entry</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cache_set_entry</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cache_line_entry</span><span class="p">));</span>
</span><span id="__span-17-180"><a id="__codelineno-17-180" name="__codelineno-17-180" href="#__codelineno-17-180"></a><span class="w">    </span><span class="c1">//first allocate the memory of sets</span>
</span><span id="__span-17-181"><a id="__codelineno-17-181" name="__codelineno-17-181" href="#__codelineno-17-181"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-182"><a id="__codelineno-17-182" name="__codelineno-17-182" href="#__codelineno-17-182"></a><span class="w">        </span><span class="n">cache</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cache_line_entry</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">E</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cache_line</span><span class="p">));</span>
</span><span id="__span-17-183"><a id="__codelineno-17-183" name="__codelineno-17-183" href="#__codelineno-17-183"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-184"><a id="__codelineno-17-184" name="__codelineno-17-184" href="#__codelineno-17-184"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span>
</span><span id="__span-17-185"><a id="__codelineno-17-185" name="__codelineno-17-185" href="#__codelineno-17-185"></a><span class="p">}</span>
</span><span id="__span-17-186"><a id="__codelineno-17-186" name="__codelineno-17-186" href="#__codelineno-17-186"></a>
</span><span id="__span-17-187"><a id="__codelineno-17-187" name="__codelineno-17-187" href="#__codelineno-17-187"></a><span class="kt">void</span><span class="w"> </span><span class="nf">free_memory</span><span class="p">(</span><span class="n">cache_set_entry</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">sets</span><span class="p">){</span>
</span><span id="__span-17-188"><a id="__codelineno-17-188" name="__codelineno-17-188" href="#__codelineno-17-188"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sets</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-189"><a id="__codelineno-17-189" name="__codelineno-17-189" href="#__codelineno-17-189"></a><span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-17-190"><a id="__codelineno-17-190" name="__codelineno-17-190" href="#__codelineno-17-190"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-191"><a id="__codelineno-17-191" name="__codelineno-17-191" href="#__codelineno-17-191"></a><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
</span><span id="__span-17-192"><a id="__codelineno-17-192" name="__codelineno-17-192" href="#__codelineno-17-192"></a><span class="p">}</span>
</span><span id="__span-17-193"><a id="__codelineno-17-193" name="__codelineno-17-193" href="#__codelineno-17-193"></a>
</span><span id="__span-17-194"><a id="__codelineno-17-194" name="__codelineno-17-194" href="#__codelineno-17-194"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
</span><span id="__span-17-195"><a id="__codelineno-17-195" name="__codelineno-17-195" href="#__codelineno-17-195"></a><span class="p">{</span>
</span><span id="__span-17-196"><a id="__codelineno-17-196" name="__codelineno-17-196" href="#__codelineno-17-196"></a><span class="w">    </span><span class="c1">//get the arguments</span>
</span><span id="__span-17-197"><a id="__codelineno-17-197" name="__codelineno-17-197" href="#__codelineno-17-197"></a>
</span><span id="__span-17-198"><a id="__codelineno-17-198" name="__codelineno-17-198" href="#__codelineno-17-198"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-17-199"><a id="__codelineno-17-199" name="__codelineno-17-199" href="#__codelineno-17-199"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">;</span>
</span><span id="__span-17-200"><a id="__codelineno-17-200" name="__codelineno-17-200" href="#__codelineno-17-200"></a><span class="w">    </span><span class="n">cache_set_entry</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span>
</span><span id="__span-17-201"><a id="__codelineno-17-201" name="__codelineno-17-201" href="#__codelineno-17-201"></a><span class="w">    </span><span class="c1">// the file initiliazer</span>
</span><span id="__span-17-202"><a id="__codelineno-17-202" name="__codelineno-17-202" href="#__codelineno-17-202"></a>
</span><span id="__span-17-203"><a id="__codelineno-17-203" name="__codelineno-17-203" href="#__codelineno-17-203"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">-1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getopt</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">,</span><span class="s">&quot;hvs:E:b:t:&quot;</span><span class="p">))){</span>
</span><span id="__span-17-204"><a id="__codelineno-17-204" name="__codelineno-17-204" href="#__codelineno-17-204"></a><span class="w">        </span><span class="k">switch</span><span class="p">(</span><span class="n">opt</span><span class="p">){</span>
</span><span id="__span-17-205"><a id="__codelineno-17-205" name="__codelineno-17-205" href="#__codelineno-17-205"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;h&#39;</span><span class="p">:</span>
</span><span id="__span-17-206"><a id="__codelineno-17-206" name="__codelineno-17-206" href="#__codelineno-17-206"></a><span class="w">                </span><span class="n">usage</span><span class="p">();</span>
</span><span id="__span-17-207"><a id="__codelineno-17-207" name="__codelineno-17-207" href="#__codelineno-17-207"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-208"><a id="__codelineno-17-208" name="__codelineno-17-208" href="#__codelineno-17-208"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;v&#39;</span><span class="p">:</span>
</span><span id="__span-17-209"><a id="__codelineno-17-209" name="__codelineno-17-209" href="#__codelineno-17-209"></a><span class="w">                </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-17-210"><a id="__codelineno-17-210" name="__codelineno-17-210" href="#__codelineno-17-210"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-211"><a id="__codelineno-17-211" name="__codelineno-17-211" href="#__codelineno-17-211"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="p">:</span>
</span><span id="__span-17-212"><a id="__codelineno-17-212" name="__codelineno-17-212" href="#__codelineno-17-212"></a><span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
</span><span id="__span-17-213"><a id="__codelineno-17-213" name="__codelineno-17-213" href="#__codelineno-17-213"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-214"><a id="__codelineno-17-214" name="__codelineno-17-214" href="#__codelineno-17-214"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">:</span>
</span><span id="__span-17-215"><a id="__codelineno-17-215" name="__codelineno-17-215" href="#__codelineno-17-215"></a><span class="w">                </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
</span><span id="__span-17-216"><a id="__codelineno-17-216" name="__codelineno-17-216" href="#__codelineno-17-216"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-217"><a id="__codelineno-17-217" name="__codelineno-17-217" href="#__codelineno-17-217"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;b&#39;</span><span class="p">:</span>
</span><span id="__span-17-218"><a id="__codelineno-17-218" name="__codelineno-17-218" href="#__codelineno-17-218"></a><span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
</span><span id="__span-17-219"><a id="__codelineno-17-219" name="__codelineno-17-219" href="#__codelineno-17-219"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-220"><a id="__codelineno-17-220" name="__codelineno-17-220" href="#__codelineno-17-220"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;t&#39;</span><span class="p">:</span>
</span><span id="__span-17-221"><a id="__codelineno-17-221" name="__codelineno-17-221" href="#__codelineno-17-221"></a><span class="w">                </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
</span><span id="__span-17-222"><a id="__codelineno-17-222" name="__codelineno-17-222" href="#__codelineno-17-222"></a><span class="w">                </span><span class="c1">// printf(&quot;%s&quot;,file);</span>
</span><span id="__span-17-223"><a id="__codelineno-17-223" name="__codelineno-17-223" href="#__codelineno-17-223"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-224"><a id="__codelineno-17-224" name="__codelineno-17-224" href="#__codelineno-17-224"></a><span class="w">            </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-225"><a id="__codelineno-17-225" name="__codelineno-17-225" href="#__codelineno-17-225"></a><span class="w">                </span><span class="n">usage</span><span class="p">();</span>
</span><span id="__span-17-226"><a id="__codelineno-17-226" name="__codelineno-17-226" href="#__codelineno-17-226"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-227"><a id="__codelineno-17-227" name="__codelineno-17-227" href="#__codelineno-17-227"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-228"><a id="__codelineno-17-228" name="__codelineno-17-228" href="#__codelineno-17-228"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-229"><a id="__codelineno-17-229" name="__codelineno-17-229" href="#__codelineno-17-229"></a><span class="w">    </span><span class="c1">//allocate memory</span>
</span><span id="__span-17-230"><a id="__codelineno-17-230" name="__codelineno-17-230" href="#__codelineno-17-230"></a><span class="w">    </span><span class="c1">//question, how to set the index bit in the cache?</span>
</span><span id="__span-17-231"><a id="__codelineno-17-231" name="__codelineno-17-231" href="#__codelineno-17-231"></a><span class="w">    </span><span class="c1">//s is used to define </span>
</span><span id="__span-17-232"><a id="__codelineno-17-232" name="__codelineno-17-232" href="#__codelineno-17-232"></a><span class="w">    </span><span class="c1">// cache[S][E], S = 2^s, </span>
</span><span id="__span-17-233"><a id="__codelineno-17-233" name="__codelineno-17-233" href="#__codelineno-17-233"></a><span class="w">    </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache_init</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-17-234"><a id="__codelineno-17-234" name="__codelineno-17-234" href="#__codelineno-17-234"></a>
</span><span id="__span-17-235"><a id="__codelineno-17-235" name="__codelineno-17-235" href="#__codelineno-17-235"></a><span class="w">    </span><span class="c1">// for (int i = 0; i &lt; s;i++){</span>
</span><span id="__span-17-236"><a id="__codelineno-17-236" name="__codelineno-17-236" href="#__codelineno-17-236"></a><span class="w">    </span><span class="c1">//     for (int j = 0; j &lt; e;j++){</span>
</span><span id="__span-17-237"><a id="__codelineno-17-237" name="__codelineno-17-237" href="#__codelineno-17-237"></a><span class="w">    </span><span class="c1">//         printf(&quot;%d  %d \n&quot;,j, cache[i][j].valid_bit);</span>
</span><span id="__span-17-238"><a id="__codelineno-17-238" name="__codelineno-17-238" href="#__codelineno-17-238"></a><span class="w">    </span><span class="c1">//     }</span>
</span><span id="__span-17-239"><a id="__codelineno-17-239" name="__codelineno-17-239" href="#__codelineno-17-239"></a><span class="w">    </span><span class="c1">// }</span>
</span><span id="__span-17-240"><a id="__codelineno-17-240" name="__codelineno-17-240" href="#__codelineno-17-240"></a><span class="w">    </span><span class="n">read_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">cache</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-17-241"><a id="__codelineno-17-241" name="__codelineno-17-241" href="#__codelineno-17-241"></a>
</span><span id="__span-17-242"><a id="__codelineno-17-242" name="__codelineno-17-242" href="#__codelineno-17-242"></a><span class="w">    </span><span class="n">printSummary</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">hit</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">miss</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">eviction</span><span class="p">);</span>
</span><span id="__span-17-243"><a id="__codelineno-17-243" name="__codelineno-17-243" href="#__codelineno-17-243"></a><span class="w">    </span><span class="n">free_memory</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-17-244"><a id="__codelineno-17-244" name="__codelineno-17-244" href="#__codelineno-17-244"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-245"><a id="__codelineno-17-245" name="__codelineno-17-245" href="#__codelineno-17-245"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="part-b">Part B:</h3>
<p>1 kilobytes of cache, E =1, Block size = 32bytes = 2^5, S = 5, 32 sets</p>
<p>int = 4bytes, 32/4 = 8, it can fit 8ints, </p>
<h4 id="32-x-32">32 x 32</h4>
<p>Explain on why diagnose will cause the cache hit the same set</p>
<h3 id="memory-address-to-cache-index-mapping">Memory Address to Cache Index Mapping</h3>
<p>In a direct-mapped cache, the cache index is determined by the formula:</p>
<p>Index=(Memory Address/Block Size)%Number of Sets\text{Index} = (\text{Memory Address} / \text{Block Size}) \% \text{Number of Sets}Index=(Memory Address/Block Size)%Number of Sets</p>
<p>Given your cache parameters:</p>
<ul>
<li><strong>Cache Size:</strong> 1 KB (1024 bytes)</li>
<li><strong>Block Size:</strong> 32 bytes</li>
<li><strong>Number of Sets:</strong> 32</li>
</ul>
<h3 id="example-calculation-address-and-index-for-akk">Example Calculation: Address and Index for <code>A[k][k]</code></h3>
<p>For diagonal element <code>A[k][k]</code> in a 32x32 matrix:</p>
<ol>
<li><strong>Memory Address Calculation:</strong></li>
<li>Base address of <code>A</code> (assumed): <code>Base Address(A) = 0x00000000</code></li>
<li>Address of <code>A[k][k]</code>: Address(A[k][k])=Base Address(A)+(k×32+k)×4\text{Address}(A[k][k]) = \text{Base Address}(A) + (k \times 32 + k) \times 4Address(A[k][k])=Base Address(A)+(k×32+k)×4 =0x00000000+(k×32+k)×4= 0x00000000 + (k \times 32 + k) \times 4=0x00000000+(k×32+k)×4 =(k×33)×4= (k \times 33) \times 4=(k×33)×4 =k×132= k \times 132=k×132</li>
<li><strong>Cache Index Calculation:</strong></li>
<li>Index=(k×132/32)%32\text{Index} = (k \times 132 / 32) \% 32Index=(k×132/32)%32</li>
<li>=(k×4.125)%32= (k \times 4.125) \% 32=(k×4.125)%32</li>
</ol>
<h3 id="example-calculation-address-and-index-for-bkk">Example Calculation: Address and Index for <code>B[k][k]</code></h3>
<p>For diagonal element <code>B[k][k]</code> in a 32x32 matrix:</p>
<ol>
<li><strong>Memory Address Calculation:</strong></li>
<li>Base address of <code>B</code> (assumed): <code>Base Address(B) = 0x00008000</code></li>
<li>Address of <code>B[k][k]</code>: Address(B[k][k])=Base Address(B)+(k×32+k)×4\text{Address}(B[k][k]) = \text{Base Address}(B) + (k \times 32 + k) \times 4Address(B[k][k])=Base Address(B)+(k×32+k)×4 =0x00008000+(k×32+k)×4= 0x00008000 + (k \times 32 + k) \times 4=0x00008000+(k×32+k)×4 =0x00008000+(k×33)×4= 0x00008000 + (k \times 33) \times 4=0x00008000+(k×33)×4 =0x00008000+k×132= 0x00008000 + k \times 132=0x00008000+k×132</li>
<li><strong>Cache Index Calculation:</strong></li>
<li>Index=((0x00008000+k×132)/32)%32\text{Index} = ((0x00008000 + k \times 132) / 32) \% 32Index=((0x00008000+k×132)/32)%32</li>
<li>=((0x00008000/32)+(k×132/32))%32= ((0x00008000 / 32) + (k \times 132 / 32)) \% 32=((0x00008000/32)+(k×132/32))%32</li>
<li>=(0x2000+k×4.125)%32= (0x2000 + k \times 4.125) \% 32=(0x2000+k×4.125)%32</li>
</ol>
<h3 id="simplifying-the-index-calculation">Simplifying the Index Calculation</h3>
<p>To see if <code>A[k][k]</code> and <code>B[k][k]</code> map to the same index, we need to examine the modulo operation:</p>
<ol>
<li><strong>For <code>A[k][k]</code>:</strong></li>
<li>(k×4.125)%32(k \times 4.125) \% 32(k×4.125)%32</li>
<li><strong>For <code>B[k][k]</code>:</strong></li>
<li>The base address <code>0x00008000</code> converts to 32768 in decimal.</li>
<li>(32768/32)=1024(32768 / 32) = 1024(32768/32)=1024</li>
<li>1024%32=01024 \% 32 = 01024%32=0</li>
<li>Therefore, the index calculation for <code>B[k][k]</code> simplifies to: (0+k×4.125)%32(0 + k \times 4.125) \% 32(0+k×4.125)%32</li>
<li>=(k×4.125)%32= (k \times 4.125) \% 32=(k×4.125)%32</li>
</ol>
<h3 id="conclusion">Conclusion</h3>
<p>Both <code>A[k][k]</code> and <code>B[k][k]</code> indeed map to the same cache index because the addition of the base address <code>0x00008000</code> results in a zero modulo 32, effectively making the cache index calculation dependent only on the <code>k \times 4.125</code> term for both matrices.</p>
<h3 id="cache-conflict-explanation">Cache Conflict Explanation</h3>
<p>Since both <code>A[k][k]</code> and <code>B[k][k]</code> map to the same cache index, they will contend for the same cache line. When you read <code>A[k][k]</code> and then write <code>B[k][k]</code>, the cache line for <code>A</code> gets evicted and replaced by the line for <code>B</code>. This causes a cache miss the next time you access <code>A[k][k]</code> or <code>B[k][k]</code>.</p>
<h4 id="64-x-64">64 x 64</h4>
<p>https://www.cnblogs.com/liqiuhao/p/8026100.html?utm_source=debugrun&amp;utm_medium=referral</p>
<p>https://zhuanlan.zhihu.com/p/387662272</p>
<p>https://zhuanlan.zhihu.com/p/42754565</p>
<p>https://zhuanlan.zhihu.com/p/79058089</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>